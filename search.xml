<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Unity 编辑器-内置GUIStyle查看工具</title>
      <link href="/2023/03/02/Unity-%E7%BC%96%E8%BE%91%E5%99%A8-%E5%86%85%E7%BD%AEGUIStyle%E6%9F%A5%E7%9C%8B%E5%B7%A5%E5%85%B7/"/>
      <url>/2023/03/02/Unity-%E7%BC%96%E8%BE%91%E5%99%A8-%E5%86%85%E7%BD%AEGUIStyle%E6%9F%A5%E7%9C%8B%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<pre><code>using UnityEngine;using UnityEditor;using System.Reflection;/// &lt;summary&gt;/// Unity 自带的 GUIStyle 效果查看器/// &lt;/summary&gt;public class GUIStyleViewerUtil : EditorWindow{    /// &lt;summary&gt;    /// 滑动条    /// &lt;/summary&gt;    private Vector2 mScrollView = Vector2.zero;    /// &lt;summary&gt;    /// 寻找的样式名称    /// &lt;/summary&gt;    private string mSearchStyle = "";    /// &lt;summary&gt;    /// 样式缓存    /// &lt;/summary&gt;    private static GUIStyle mBtnStyle;  [MenuItem("Util/GUIStyle 效果查看器")]  private static void MenuClicked()  {      GetWindow&lt;GUIStyleViewerUtil&gt;("GUIStyle查看器", true);      // 初始化一个按钮的样式      mBtnStyle = GetBtnStyle();  }  private void OnGUI()  {      GUILayout.Space(20);      // 设置一个查找的功能      GUILayout.BeginHorizontal("HelpBox");      GUILayout.Space(20);      mSearchStyle = EditorGUILayout.TextField("", mSearchStyle, "SearchTextField");      GUILayout.Label("", "SearchCancelButtonEmpty");      GUILayout.EndHorizontal();      // 设置滚动栏      mScrollView = GUILayout.BeginScrollView(mScrollView);      // 遍历并显示所有符合条件的 Unity 自带的 GUIStyle      foreach (GUIStyle style in GUI.skin.customStyles)      {          if (style.name.ToLower().Contains(mSearchStyle.ToLower()))          {              GUILayout.Space(10);              // 为了让显示的布局看着更舒服一些，需要以当前 style 为原型新建一个 GUIStyle              // 因为接下来可能会对文字居中等方面进行调整，              // 而如果直接更改原来的 style，则会导致系统中的对应 UI 样式和布局也发生改变              GUIStyle tmp = new GUIStyle(style);              DrawStyleItem(tmp);          }      }      GUILayout.EndScrollView();  }  /// &lt;summary&gt;  /// 绘制对应的 GUIStyle  /// &lt;/summary&gt;  /// &lt;param name="style"&gt;&lt;/param&gt;  private void DrawStyleItem(GUIStyle style)  {      GUILayout.BeginHorizontal("box", GUILayout.Height(style.fixedHeight));      GUILayout.Space(20);      // 获取按钮样式      GUIStyle tmp = mBtnStyle;      // 设置第一个按钮，点击后可以复制当前 GUIStyle 的名字信息      if (GUILayout.Button("&lt;color=#000000FF&gt;复制到剪贴板&lt;/color&gt;", tmp))      {          GUIUtility.systemCopyBuffer = style.name;      }      GUILayout.Space(20);      // 设置第二个按钮，点击后在控制台输出该 GUIStyle 的设置参数      if (GUILayout.Button("&lt;color=#FFFFFFFF&gt;查看Style参数&lt;/color&gt;", tmp))      {          ShowGUIStyleMsg(style.name);      }      GUILayout.Space(30);      // 显示当前 GUIStyle 的名字      EditorGUILayout.SelectableLabel(style.name);      // 设置左右对称布局，以此为分界线，把前后的布局对称      GUILayout.FlexibleSpace();      // 设置文本居中显示      style.alignment = TextAnchor.MiddleCenter;      // 显示当前的样式及其名称      EditorGUILayout.SelectableLabel(style.name, style);      GUILayout.Space(100);      // 单独显示样式      EditorGUILayout.SelectableLabel("", style,                                      GUILayout.Height(style.fixedHeight),                                       GUILayout.Width(style.fixedWidth));      GUILayout.Space(100);      GUILayout.EndHorizontal();  }  /// &lt;summary&gt;  /// 创建一个按钮样式，用来作为本界面中的按钮基础  /// &lt;/summary&gt;  /// &lt;returns&gt;&lt;/returns&gt;  public static GUIStyle GetBtnStyle()  {      // 使用系统自带的 "AC Button" 样式作为原型，因为 "AC Button" 本身就具有点击效果了      GUIStyle style = new GUIStyle("AC Button");      // 将样式的点击时的效果图，替换为系统自带的 "flow node 4 on" 样式      GUIStyle active = new GUIStyle("flow node 4 on");      style.active.background = active.normal.background;      // 将平时按钮的效果图，替换为系统自带的 "flow node 4" 样式      GUIStyle normal = new GUIStyle("flow node 4");      style.normal.background = normal.normal.background;      // 参考 "flow node 4" 的内部参数，设置一些图片的参数。      // 如果不设置的话，则图片会按照原 "AC Button" 的样式进行显示      // 因为图片不一样，所以会有显示上的问题。      style.stretchHeight = true;      style.stretchWidth = true;      style.border = new RectOffset(11, 11, 11, 15);      style.margin = new RectOffset(0, 0, 0, 0);      style.padding = new RectOffset(0, 0, 0, 0);      style.overflow = new RectOffset(7, 7, 6, 9);      // 进行文本方面的设置      style.alignment = TextAnchor.MiddleCenter;      style.fontSize = 18;      style.richText = true;      return style;  }  /// &lt;summary&gt;  /// 展示指定的 GUI 样式的一些数值  /// &lt;/summary&gt;  /// &lt;param name="style"&gt;&lt;/param&gt;  public void ShowGUIStyleMsg(string style)  {      // 清空控制台信息，防止混淆      ClearConsole();      GUIStyle tmp = new GUIStyle(style);      Debug.Log("Style Name: " + tmp.name);      Debug.Log("Style Normal: " + tmp.normal.background);      Debug.Log("Style Normal Color: " + tmp.normal.textColor);      Debug.Log("Style Active: " + tmp.active.background);      Debug.Log("Style Active Color: " + tmp.active.textColor);      Debug.Log("Style Hover: " + tmp.hover.background);      Debug.Log("Style Hover Color: " + tmp.hover.textColor);      Debug.Log("Style Focused: " + tmp.focused.background);      Debug.Log("Style Focused Color: " + tmp.focused.textColor);      Debug.Log("Style border: " + tmp.border);      Debug.Log("Style margin: " + tmp.margin);      Debug.Log("Style padding: " + tmp.padding);      Debug.Log("Style overflow: " + tmp.overflow);      Debug.Log("Style fixedWidth: " + tmp.fixedWidth);      Debug.Log("Style fixedHeight: " + tmp.fixedHeight);      Debug.Log("Style stretchWidth: " + tmp.stretchWidth);      Debug.Log("Style stretchHeight: " + tmp.stretchHeight);      Debug.Log("Style lineHeight: " + tmp.lineHeight);      Debug.Log("Style Font: " + tmp.font);      Debug.Log("Style Font Size: " + tmp.fontSize);  }  public void ClearConsole()  {      Assembly assembly = Assembly.GetAssembly(typeof(SceneView));      System.Type type = assembly.GetType("UnityEditor.LogEntries");      MethodInfo method = type.GetMethod("Clear");      method.Invoke(new object(), null);  }}</code></pre>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity Editor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>宝藏网站（持续更新）</title>
      <link href="/2023/03/02/%E5%AE%9D%E8%97%8F%E7%BD%91%E7%AB%99%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/"/>
      <url>/2023/03/02/%E5%AE%9D%E8%97%8F%E7%BD%91%E7%AB%99%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p><a href="https://convertio.co/zh/" target="_blank" rel="noopener">在线格式转换器</a></p><p><a href="https://www.aplaybox.com/" target="_blank" rel="noopener">模之屋</a></p><h2 id="图形相关"><a href="#图形相关" class="headerlink" title="图形相关"></a>图形相关</h2><p><a href="https://roystan.net/articles/" target="_blank" rel="noopener">Roystan</a></p><p><a href="https://www.shadertoy.com/" target="_blank" rel="noopener">Shadertoy</a></p><p><a href="https://catlikecoding.com/unity/tutorials/custom-srp/draw-calls/#2.1" target="_blank" rel="noopener">Draw Calls</a></p><p><a href="https://zhuanlan.zhihu.com/p/433385999" target="_blank" rel="noopener">菜鸡都能学会的Unity草地shader</a></p><p><a href="https://zhuanlan.zhihu.com/p/47575695" target="_blank" rel="noopener">肥皂泡的渲染（薄膜干涉）</a></p><p><a href="https://www.zhihu.com/column/c_1215952152252121088" target="_blank" rel="noopener">从零开始的卡通渲染</a></p><h2 id="编辑器相关"><a href="#编辑器相关" class="headerlink" title="编辑器相关"></a>编辑器相关</h2><p><a href="https://blog.csdn.net/alexhu2010q/article/details/118053288" target="_blank" rel="noopener">UnityGraphView</a></p><p><a href="https://blog.csdn.net/alexhu2010q/article/details/118053288" target="_blank" rel="noopener">Unity的GraphView</a></p><p><a href="https://focus-creative-games.github.io/hybridclr/about/#文档" target="_blank" rel="noopener">HybridCLR</a></p><h2 id="大佬的个人网站"><a href="#大佬的个人网站" class="headerlink" title="大佬的个人网站"></a>大佬的个人网站</h2><p><a href="https://yremp.live/" target="_blank" rel="noopener">Yremp</a></p><p><a href="https://2heng.xin/" target="_blank" rel="noopener">Mashiro</a></p><p><a href="http://walkingfat.com/" target="_blank" rel="noopener">Walkingfat</a></p><p><a href="https://www.patreon.com/minionsart/" target="_blank" rel="noopener">Minionsart</a></p><p><a href="https://www.lfzxb.top/" target="_blank" rel="noopener">烟雨迷离半世殇</a></p>]]></content>
      
      
      <categories>
          
          <category> Commom </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>记录一些HLSL常用函数</title>
      <link href="/2023/03/02/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%BA%9BHLSL%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/"/>
      <url>/2023/03/02/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%BA%9BHLSL%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<p>查看函数图像网站：<a href="https://graphtoy.com/" target="_blank" rel="noopener">https://graphtoy.com/</a></p><h2 id="基础数学运算"><a href="#基础数学运算" class="headerlink" title="基础数学运算"></a>基础数学运算</h2><ul><li>max（a, b） 返回较大的数</li><li>min（a, b） 返回较小的数</li><li>mul（a, b） 两变量相乘，常用于矩阵运算</li><li>abs（a） 返回a的绝对值</li><li>round (x) 返回与x最近的整数</li><li>sqrt (x) 返回x的平方根</li><li>rsqrt (x) 返回x的平方根的倒数</li><li>degrees (x) 弧度转角度</li><li>redians (x) 角度转弧度</li><li>noise (x) 噪声</li></ul><h2 id="幂指对函数"><a href="#幂指对函数" class="headerlink" title="幂指对函数"></a>幂指对函数</h2><ul><li>pow (x, y) x的y次幂</li><li>exp (x) 返回e为底的指数函数</li><li>exp2 (value x) 返回以2位底，x为指数幂</li><li>ldexp (x, exp) 返回与2exp次方的乘积</li><li>log (x) 返回指定值得以e为底数的对数</li><li>log10 (x) 求以10为底的对数</li><li>log2 (x) 求以2为底的对数</li><li>frexp (x , out exp) 将浮点数分解成尾数和指数，x的返回值是尾数,exp参数返回的值是指数</li></ul><h2 id="三角函数和双曲线函数"><a href="#三角函数和双曲线函数" class="headerlink" title="三角函数和双曲线函数"></a>三角函数和双曲线函数</h2><ul><li>sin（x）、cos（x）、tan（x） 三角函数</li><li>asin（x）、acos（x）、atan（x） 反三角函数</li><li>sincos（x，out s，out c） 返回x的正弦和余弦</li><li>tan（y，x） 返回y/x的正切</li><li>atan2（y，x） 返回y/x的反正切</li><li>sinh（x） 返回x的双曲正弦值</li><li>cosh（x） 返回x的双曲余弦值</li><li>tanh（x） 返回x的双曲正弦值</li></ul><h2 id="处理数值函数"><a href="#处理数值函数" class="headerlink" title="处理数值函数"></a>处理数值函数</h2><ul><li>ceil（x） 返回&gt;=x的最小整数（向下取整）</li><li>floor（x） 返回&lt;=x的最大整数（向上取整）</li><li>step（x，y） x&lt;=y返回1，否则返回0</li><li>saturate（x） 返回将x钳制到[0,1]范围之间的值</li><li>clamp（x，min，max） 将x限制在[min，max]范围的值，比min小返回min，比max大返回max</li><li>fmord（x，y） 返回x对y取余的余数</li><li>frac（x） 取x的小数部分</li><li>modf（x，out ip） 将x分为小数和整数部分（输出的ip为整数部分，返回值为小数部分）</li><li>lerp（x，y，s） 按照s在x到y之间插值，返回</li><li>smoothstep（min，max，x） 如果x在[min，max]范围内，就返回介于[0，1]之间的平滑Hermite插值，使用smoothstep在两个值创建平滑过渡</li></ul><h2 id="条件判断函数"><a href="#条件判断函数" class="headerlink" title="条件判断函数"></a>条件判断函数</h2><ul><li>all（x） 确定指定量的所有分量是否均为非零，均非零则返回true，否则返回false</li><li>clip（x） 如果输入值小于零，则丢弃当前像素 常用于判定范围(不仅仅针对0,返回值为void) <strong>常用于Alpha测试，如果每个分量代表到平面的距离，还可以用来模拟剪切平面</strong></li><li>sign（x） 返回x的正负性 如果x小于零返回-1，如果x等于零返回0，如果x大于零返回1</li><li>isinf（x） 如果x参数为+ INF或-INF(无穷+无穷仍无穷，0x3f3f3f3f)，返回true，否则返回False</li><li>isfinite（x） 判断x参数是有限，即有界的，与isinf(x)相反</li><li>isnan（x） 如果x参数为NAN(非数字)，返回true，否则返回false</li></ul><h2 id="向量和矩阵函数"><a href="#向量和矩阵函数" class="headerlink" title="向量和矩阵函数"></a>向量和矩阵函数</h2><ul><li>length(v) 返回向量的长度</li><li>normalize(v) 向量归一化</li><li>distance(a,b) 返回两个向量之间的距离，不平行的两个向量应该为0，此处表示为根号下各分量之差的平方和</li><li>dot(a,b) 返回a和b两向量的点积</li><li>cross(a,b) 返回a和b两向量的叉积，返回值是向量，并且与a,b都垂直</li><li>determinant(m) 返回指定浮点矩阵的按行列式方式计算的值</li><li>transpose(m) 返回矩阵m的转置矩阵</li></ul><h2 id="光线预算函数"><a href="#光线预算函数" class="headerlink" title="光线预算函数"></a>光线预算函数</h2><ul><li>reflect(i,n) 以i为入射向量n为法线方向的反射光</li><li>refract(i,n,ri) 以i为入射向量n为法线方向,ri为折射率的折射光</li><li>lit(n_dot_l,n_dot_h，m) 输入标量(normal,light,半角向量h,镜面反射系数m) 返回光照向量(环境光，漫反射光，镜面高光反射，1)<strong>该计算依据的是BlingPhong光照模型</strong></li><li>faceforward(n,i,ng) 得到面向视图方向的曲面法向量输入输出为同元向量,返回-n*sign(dot(i,ng))(normal,light,normal)</li></ul><h2 id="纹理查找函数"><a href="#纹理查找函数" class="headerlink" title="纹理查找函数"></a>纹理查找函数</h2><h3 id="1D纹理查找函数"><a href="#1D纹理查找函数" class="headerlink" title="1D纹理查找函数"></a>1D纹理查找函数</h3><ul><li>tex1D(s, t) 普通一维纹理查找 返回纹理采样器s在标量t位置的color4</li><li>tex1D(s,t,ddx,ddy) 使用微分查询一维纹理， t和ddxy均为vector</li><li>tex1Dlod(s, t) 使用LOD查找纹理s在t.w位置的color4</li><li>tex1Dbias(s, t) 将t.w决定的某个MIP层偏置后的一维纹理查找</li><li>tex1Dgrad(s,t,ddx,ddy) 使用微分并指定MIP层的一维纹理查找</li><li>tex1Dproj(s, t) 把纹理当做一张幻灯片投影到场景中，先使用投影纹理技术需要计算出投影纹理坐标t(坐标t.w除以透视值)，然后使用投影纹理坐标进行查询</li></ul><h3 id="2D纹理查找函数"><a href="#2D纹理查找函数" class="headerlink" title="2D纹理查找函数"></a>2D纹理查找函数</h3><ul><li>tex2D(s, t) 普通二维纹理查找 返回纹理采样器s在vector t位置的颜色</li><li>ex2D(s,t,ddx,ddy) 使用微分查询二维纹理，t和ddxy均为vector</li><li>tex2Dlod(s, t) 使用LOD查找纹理s在t.w位置的color4</li><li>tex2Dbias(s, t) 将t.w决定的某个MIP层偏置后的二维纹理查找</li><li>tex2Dgrad(s,t,ddx,ddy) 使用微分并指定MIP层的二维纹理查找</li><li>tex2Dproj(s, t) 把纹理当做一张幻灯片投影到场景中，先使用投影纹理技术需要计算出投影纹理坐标t(坐标t.w除以透视值)，然后使用投影纹理坐标进行查询</li></ul><h3 id="3D纹理查找函数"><a href="#3D纹理查找函数" class="headerlink" title="3D纹理查找函数"></a>3D纹理查找函数</h3><ul><li>tex3D(s, t) 普通三维纹理查找 返回纹理采样器s在vector t位置的颜色</li><li>ex3D(s,t,ddx,ddy) 使用微分查询三维纹理，t和ddxy均为vector</li><li>tex3Dlod(s, t) 使用LOD查找纹理s在t.w位置的color4</li><li>tex3Dbias(s, t) 将t.w决定的某个MIP层偏置后的三维纹理查找</li><li>tex3Dgrad(s,t,ddx,ddy) 使用微分并指定MIP层的三维纹理查找</li><li>tex3Dproj(s, t) 把纹理当做一张幻灯片投影到场景中，先使用投影纹理技术需要计算出投影纹理坐标t(坐标t.w除以透视值)，然后使用投影纹理坐标进行查询</li></ul><h3 id="立体纹理查找"><a href="#立体纹理查找" class="headerlink" title="立体纹理查找"></a>立体纹理查找</h3><ul><li>texCUBE(s,t) 返回纹理采样器s在vector t位置的颜色</li><li>texCUBE(s,t,ddx,ddy) 使用微分查询立方体维纹理 ，t和ddxy均为vector</li><li>texCUBEDload(s,t) 使用LOD查找纹理s在t.w位置的color4</li><li>texCUBEbias(s,t) 将t.w决定的某个MIP层偏置后的立方体纹理查找</li><li>texCUBEgrad(s,t,ddx,ddy) 使用微分并指定MIP层的立方体纹理查找</li><li>texCUBEproj(s,t) 使用投影方式的立方体纹理查找</li></ul><h2 id="偏导函数ddx和ddy"><a href="#偏导函数ddx和ddy" class="headerlink" title="偏导函数ddx和ddy"></a>偏导函数ddx和ddy</h2><p>ddx(vector3)、ddy(vector3) ddx 和 ddy 用于求取相邻像素间某属性的差值</p><p><img src="http://acgloby.com/wp-content/uploads/2021/11/ddx.png" alt="img"></p><h3 id="Core-hlsl"><a href="#Core-hlsl" class="headerlink" title="Core.hlsl"></a>Core.hlsl</h3><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>GetVertexPositionInputs(float3 positionOS)</td><td>获取输入顶点坐标信息</td></tr><tr><td>GetVertexNormalInputs(float3 normalOS)</td><td>获取输入顶点法线信息</td></tr><tr><td>GetVertexNormalInputs(float3 normalOS, float4 tangentOS)</td><td>获取输入顶点法线信息（重载）</td></tr><tr><td>GetScaledScreenParams()</td><td>获取屏幕缩放参数信息</td></tr><tr><td>NormalizeNormalPerVertex(real3 normalWS)</td><td>逐顶点法线正交</td></tr><tr><td>NormalizeNormalPerPixel(real3 normalWS)</td><td>逐像素法线正交</td></tr><tr><td>ComputeScreenPos(float4 positionCS)</td><td>计算屏幕坐标信息</td></tr><tr><td>（real）ComputeFogFactor(float z)</td><td>计算雾参数</td></tr><tr><td>（real）ComputeFogIntensity(real fogFactor)</td><td>计算雾强度</td></tr><tr><td>（half3）MixFogColor(real3 fragColor, real3 fogColor, real fogFactor)</td><td>混合雾颜色</td></tr><tr><td>（half3）MixFog(real3 fragColor, real fogFactor)</td><td>混合雾</td></tr></tbody></table><h3 id="Lighting-hlsl"><a href="#Lighting-hlsl" class="headerlink" title="Lighting.hlsl"></a>Lighting.hlsl</h3><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>DistanceAttenuation(float distanceSqr, half2 distanceAttenuation)</td><td>距离衰减</td></tr><tr><td>AngleAttenuation(half3 spotDirection, half3 lightDirection, half2 spotAttenuation)</td><td>角度衰减</td></tr><tr><td>GetMainLight()/GetMainLight(float4 shadowCoord)</td><td>获取主光源</td></tr><tr><td>GetPerObjectLightIndex(int index)</td><td>获取每个对象灯光Index</td></tr><tr><td>GetAdditionalLightsCount()</td><td>获取额外灯光数量</td></tr><tr><td>ReflectivitySpecular(half3 specular)</td><td>高光反射率</td></tr><tr><td>OneMinusReflectivityMetallic(half metallic)</td><td>OneMinus金属反射率</td></tr><tr><td>InitializeBRDFData(half3 albedo, half metallic, half3 specular, half smoothness, half alpha, out BRDFData outBRDFData)</td><td>初始化BRDF</td></tr><tr><td>EnvironmentBRDF(BRDFData brdfData, half3 indirectDiffuse, half3 indirectSpecular, half fresnelTerm)</td><td>环境BRDF</td></tr><tr><td>DirectBDRF(BRDFData brdfData, half3 normalWS, half3 lightDirectionWS, half3 viewDirectionWS)</td><td>BRDF</td></tr><tr><td>SampleLightmap(float2 lightmapUV, half3 normalWS)</td><td>光照贴图</td></tr><tr><td>GlossyEnvironmentReflection(half3 reflectVector, half perceptualRoughness, half occlusion)</td><td>环境光泽反射</td></tr><tr><td>GlobalIllumination(BRDFData brdfData, half3 bakedGI, half occlusion, half3 normalWS, half3 viewDirectionWS)</td><td>全局光照</td></tr><tr><td>MixRealtimeAndBakedGI(inout Light light, half3 normalWS, inout half3 bakedGI, half4 shadowMask)</td><td>实时烘培混合</td></tr><tr><td>LightingLambert(half3 lightColor, half3 lightDir, half3 normal)</td><td>兰伯特模型</td></tr><tr><td>LightingSpecular(half3 lightColor, half3 lightDir, half3 normal, half3 viewDir, half4 specular, half smoothness)</td><td>高光</td></tr><tr><td>LightingPhysicallyBased(BRDFData brdfData, half3 lightColor, half3 lightDirectionWS, half lightAttenuation, half3 normalWS, half3 viewDirectionWS)/LightingPhysicallyBased(BRDFData brdfData, Light light, half3 normalWS, half3 viewDirectionWS)</td><td>基于物理的光照模型</td></tr><tr><td>VertexLighting(float3 positionWS, half3 normalWS)</td><td>顶点光照颜色</td></tr><tr><td>LightweightFragmentPBR(InputData inputData, half3 albedo, half metallic, half3 specular,half smoothness, half occlusion, half3 emission, half alpha)</td><td>轻量级片元PBR</td></tr><tr><td>LightweightFragmentBlinnPhong(InputData inputData, half3 diffuse, half4 specularGloss, half smoothness, half3 emission, half alpha)</td><td>轻量级片元布林·冯</td></tr></tbody></table><h3 id="Shadows-hlsl"><a href="#Shadows-hlsl" class="headerlink" title="Shadows.hlsl"></a>Shadows.hlsl</h3><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>GetMainLightShadowStrength()</td><td>获取主光源阴影强度</td></tr><tr><td>GetAdditionalLightShadowStrenth(int lightIndex)</td><td>获取额外光源阴影强度</td></tr><tr><td>SampleScreenSpaceShadowmap(float4 shadowCoord)</td><td>屏幕空间阴影贴图</td></tr><tr><td>SampleShadowmap(float4 shadowCoord, TEXTURE2D_SHADOW_PARAM(ShadowMap, sampler_ShadowMap), ShadowSamplingData samplingData, half shadowStrength, bool isPerspectiveProjection = true)</td><td>阴影贴图</td></tr><tr><td>TransformWorldToShadowCoord(float3 positionWS)</td><td>把顶点的世界坐标转换到阴影坐标</td></tr><tr><td>MainLightRealtimeShadow(float4 shadowCoord)</td><td>主光源实时阴影</td></tr><tr><td>AdditionalLightRealtimeShadow(int lightIndex, float3 positionWS)</td><td>额外光源实时阴影</td></tr><tr><td>GetShadowCoord(VertexPositionInputs vertexInput)</td><td>获取阴影坐标信息</td></tr><tr><td>ApplyShadowBias(float3 positionWS, float3 normalWS, float3 lightDirection)</td><td>应用阴影偏移</td></tr></tbody></table><h3 id="SpaceTransforms-hlsl"><a href="#SpaceTransforms-hlsl" class="headerlink" title="SpaceTransforms.hlsl"></a>SpaceTransforms.hlsl</h3><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>TransformObjectToWorld(float3 positionOS)</td><td>当前模型空间转世界空间矩阵，通常用于把顶点/方向矢量从模型空间转到世界空间</td></tr><tr><td>TransformWorldToObject(float3 positionWS)</td><td>当前世界空间转模型空间矩阵，通常用于把顶点/方向矢量从世界空间转到模型空间</td></tr><tr><td>TransformWorldToView(float3 positionWS)</td><td>当前世界空间转相机空间矩阵，通常用于把顶点/方向矢量从世界空间转到相机空间</td></tr><tr><td>TransformObjectToHClip(float3 positionOS)</td><td>当前模型空间转裁剪空间矩阵，通常用于把顶点/方向矢量从模型空间转到裁剪空间</td></tr><tr><td>TransformWorldToHClip(float3 positionWS)</td><td>当前世界空间转裁剪空间矩阵，通常用于把顶点/方向矢量从世界空间转到裁剪空间</td></tr><tr><td>TransformWViewToHClip(float3 positionVS)</td><td>当前相机空间转裁剪空间矩阵，通常用于把顶点/方向矢量从相机空间转到裁剪空间</td></tr><tr><td>TransformObjectToWorldDir(real3 dirOS)</td><td>把方向矢量从模型空间转换到世界空间中</td></tr><tr><td>TransformWorldToObjectDir(real3 dirWS)</td><td>把方向矢量从世界空间转换到模型空间中</td></tr><tr><td>TransformWorldToViewDir(real3 dirWS)</td><td>把方向矢量从世界空间转换到相机空间中</td></tr><tr><td>TransformWorldToHClipDir(real3 directionWS)</td><td>把方向矢量从世界空间转换到裁剪空间中</td></tr><tr><td>TransformObjectToWorldNormal(float3 normalOS)</td><td>把法线从模型空间转换到世界空间中</td></tr><tr><td>CreateTangentToWorld(real3 normal, real3 tangent, real flipSign)</td><td>创建一个切线空间转为世界空间的3x3矩阵</td></tr><tr><td>TransformTangentToWorld(real3 dirTS, real3x3 tangentToWorld)</td><td>当前切线空间转世界空间矩阵，通常用于把顶点/方向矢量从切线空间转到世界空间</td></tr><tr><td>TransformWorldToTangent(real3 dirWS, real3x3 tangentToWorld)</td><td>当前世界空间转切线空间矩阵，通常用于把顶点/方向矢量从世界空间转到切线空间</td></tr><tr><td>TransformTangentToObject(real3 dirTS, real3x3 tangentToWorld)</td><td>当前切线空间转模型空间矩阵，通常用于把顶点/方向矢量从切线空间转到模型空间</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> HLSL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity HLSL Shader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity Shader Build-In To HLSL</title>
      <link href="/2023/02/25/Unity-Shader-Build-In-To-HLSL/"/>
      <url>/2023/02/25/Unity-Shader-Build-In-To-HLSL/</url>
      
        <content type="html"><![CDATA[<h3 id="记录一些常用的-Build-In-到-HLSL-的函数"><a href="#记录一些常用的-Build-In-到-HLSL-的函数" class="headerlink" title="记录一些常用的 Build-In 到 HLSL 的函数"></a>记录一些常用的 Build-In 到 HLSL 的函数</h3><h6 id="光照模式"><a href="#光照模式" class="headerlink" title="光照模式"></a>光照模式</h6><table><thead><tr><th style="text-align:left">Bulid - In</th><th>URP</th></tr></thead><tbody><tr><td style="text-align:left">ForwardBase</td><td>UniversalForward</td></tr><tr><td style="text-align:left">ForwardAdd</td><td>开启关键字 _ADDTIONAL_LIGHTS</td></tr><tr><td style="text-align:left">ShadowCaster</td><td>ShadowCaster</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity Shader HLSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用手册</title>
      <link href="/2022/01/14/%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/"/>
      <url>/2022/01/14/%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="HEXO使用手册"><a href="#HEXO使用手册" class="headerlink" title="HEXO使用手册"></a>HEXO使用手册</h1><p>测试和搭建环境</p><ul><li><code>hexo clean</code>清除了你之前生成的东西，也可以不加。</li><li><code>hexo new newpage</code> 新建一个文章</li><li><code>hexo generate</code> 顾名思义，生成静态文章，可以用 <code>hexo g</code>缩写</li><li><code>hexo deploy</code> 部署文章，可以用<code>hexo d</code>缩写</li><li><code>hexo new draft newpage</code> 新建一个 <code>newpage.md</code> 文件</li><li><code>hexo publish draft newpage</code>发布post</li></ul><p><a href="https://blog.csdn.net/sinat_37781304/article/details/82729029" target="_blank" rel="noopener">hexo史上最全搭建教程</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>技能系统-主动技能</title>
      <link href="/2022/01/02/%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F-%E4%B8%BB%E5%8A%A8%E6%8A%80%E8%83%BD/"/>
      <url>/2022/01/02/%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F-%E4%B8%BB%E5%8A%A8%E6%8A%80%E8%83%BD/</url>
      
        <content type="html"><![CDATA[<h2 id="技能系统简述"><a href="#技能系统简述" class="headerlink" title="技能系统简述"></a>技能系统简述</h2><p>技能系统使用组件式开发，由一个SKillEntity管理所有的Component，Compoent负责实现模块的具体功能，技能分为主动技能和被动技能。</p><h4 id="主动技能-SkillEntity"><a href="#主动技能-SkillEntity" class="headerlink" title="主动技能(SkillEntity)"></a>主动技能(SkillEntity)</h4><p>主动技能有根据释放类型不同分为普通技能、开关技能、蓄力技能、循环技能等…，根据外部系统分为普通攻击、普通技能和大招等…有些特殊的系统会加入其他类型的技能比如QTE之类的。</p><h3 id="SkillEntity"><a href="#SkillEntity" class="headerlink" title="SkillEntity"></a>SkillEntity</h3><ul><li>释放条件 <code>SkillConditionComponent</code></li><li>技能释放 <code>SkillBasicComponent</code></li><li>技能配置 <code>SkillData</code></li></ul><h3 id="SkillData"><a href="#SkillData" class="headerlink" title="SkillData"></a>SkillData</h3><p>技能配置数据由三个部分和一个参数组成</p><ul><li><code>ConfData</code>（Excel配置，主要是一些外部系统配置如：技能描述、图标、名字等…，以及一些数值相关的配置如：技能伤害计算相关联属性）</li><li><code>EditorData</code>（技能编辑器配置，包含技能目标选择条件、技能范围、释放条件在什么条件下释放什么效果，在什么时间释放什么技能效果播什么动作和音效，技能效果（伤害，位移，发射子物体，子弹时间、时间减速等…））</li><li><code>SkillBlock</code>列表（一个技能分为多个SkillBlock，相当于释放技能时根据条件的不同选择释放不同的SkillBlock,释放的Effect是由SkillBlock来管理释放的。如：目标身上有id为2333的buff时释放瞬移到目标位置，没有时释放一个向前的范围伤害，这两个不同的需求算作一个Skill，两个SkillBlock，每个SkillBlock下的Effect不同）</li><li><code>EffectData</code>列表 （技能包含的所有Effect）</li><li><code>SkillAction</code>列表（技能动作）</li></ul><p><a href="http://acgloby.com/wp-content/uploads/2021/11/image-2.png" target="_blank" rel="noopener"><img src="技能系统-主动技能/image-2.png" alt="img"></a></p><p>上图配置是在范围内筛选出一个目标作为技能目标，在范围内可以释放技能，否则朝向目标移动。</p><h3 id="SkillBlock"><a href="#SkillBlock" class="headerlink" title="SkillBlock"></a>SkillBlock</h3><ul><li><code>**SkillBlockData** Data</code>；</li><li><code>**List&lt;EffectData&gt;** effectDatas</code>;</li></ul><p><a href="http://acgloby.com/wp-content/uploads/2021/11/SkillBlock.png" target="_blank" rel="noopener"><img src="技能系统-主动技能/SkillBlock.png" alt="img"></a></p><p><code>SkillBlock</code>封装技能具体实现配置，一个完整的技能由多个<code>SkillBlock</code>数据组成，每个<code>SkillBlock</code>都是一个完整的技能表现。</p><ul><li>第一部分SkillBlock是技能中的索引配置，当前执行完之后跳转的索引。</li><li>第二部分是SkillBlock执行的条件，填Condition找对应的Condition配置检测条件通过后执行。</li><li>第三部分是技能打断条件，分三部分时间和打断行为类型。</li><li>第四部分是技能的动作配置，动作融合。</li><li>第五部分是技能效果<code>Effect</code>，技能产生的效果，如：造成伤害，位移，击飞，子弹时间，屏幕效果等。</li></ul><h2 id="Effect"><a href="#Effect" class="headerlink" title="Effect"></a>Effect</h2><p>技能效果，是技能直接作用于游戏逻辑的，如伤害会对目标造成伤害同时对方播受击动画特效等；位移会强制改变目标位置；击飞会对权重低目标产生击飞的效果，子弹时间会改变除目标外其他角色的时间增量；时间减速会改变TimeScale等。</p><ul><li>Id，Name，Type，开始时间，持续时间，释放概率等一些基础功能。</li><li>控制技能效果生效的SkillConditon。</li><li>播放音效。</li><li>播放特效。</li><li>目标类型范围，用于筛选在范围内可被作为目标的角色。</li></ul><p><code>Effect</code>作为所有技能效果的基类，所有的技能效果都继承自<code>Effect</code>。</p><p><a href="http://acgloby.com/wp-content/uploads/2021/11/image-4.png" target="_blank" rel="noopener"><img src="技能系统-主动技能/image-4.png" alt="img"></a></p><p>上图是改变相机镜头缩放的技能效果。</p><p>除了Effect的基础功能外，Zoom效果实现了对相机FOV和，GroupFramingSize的改变，同时加入了淡入淡出和曲线的功能，实现了镜头缩放的效果。</p><h2 id="SkillEntity实现细节"><a href="#SkillEntity实现细节" class="headerlink" title="SkillEntity实现细节"></a>SkillEntity实现细节</h2><h3 id="SkillBasicComponent"><a href="#SkillBasicComponent" class="headerlink" title="SkillBasicComponent"></a>SkillBasicComponent</h3><ul><li><code>**SkillBlock** playingSkillBlock;</code>// 当前正在执行的SkillBlock</li></ul><p>技能逻辑处理组件，处理SkillBlock逻辑，当SkillEnity创建时就开始Tick增加计算技能的时间轴，当前一个SkillBlock时间完成后跳转到一下个SkillBlock。</p><ul><li><code>**ISkillCaster** caster;</code> // 施法者</li><li><code>**ISkillReceiver** receiver;</code> // 被施法者</li></ul><p>技能需要有施法者和被施法者，技能效果所有的逻辑处理都基于施法者和被施法者，ISkillCaster和ISkillReceiver中规范了处理技能相关用到的一些方法，角色属性数据如：（生命值，攻击力，防御力等…），Transform信息，角色系别阵营如：（比如金木研属于青铜树，董香属于古董），战斗阵营信息（有方角色&amp;敌方角色等..）</p><h4 id="计时相关"><a href="#计时相关" class="headerlink" title="计时相关"></a>计时相关</h4><ul><li><code>**FixedCounter** EffectiveTimer；</code>// 当前的Effect</li><li><code>**FixedCounter** CoolTimer;</code>// 技能冷却时间</li></ul><p>FixedCounter是封装的计时器，设置最大值，在Tick中驱动，用于处理时间相关功能。常用参数有当前值，最大值，百分比值，设置增长值，是否完成计时等。</p><p>EffectiveTimer用作当前Effect的计时器</p><p>CoolTimer用作于技能冷却时间</p><h4 id="Tick"><a href="#Tick" class="headerlink" title="Tick"></a>Tick</h4><ul><li><code>TickEffective()</code> // 技能效果</li><li><code>TickCool()</code>// 冷却时间</li><li><code>TickAccumlateSkill()</code>// 蓄力技</li><li><code>TickOnOffSkill()</code>// 开关技</li><li><p>扩展其他类型的技能…</p></li><li><p>普通攻击Tick的deltaTime需要计算攻击速度</p></li><li>蓄力技需要处理释放逻辑，具体看技能是怎么实现的，如果说蓄力是由配置来决定跳转的SkillBlock那么只需处理释放就行了，蓄满后多长时间自动释放。设计成SkillBlock跳转，就是每个SkillBlock设置一定时长，蓄力时间达到这个SkillBlock跳转下一个蓄力SkillBlock，如果在当前SkillBlock释放的话直接跳转对应技能效果的SkillBlock。如果是需要记录蓄力时长那么久需要记录当前蓄力时间，设计的时候需要定制每个SkillBlock的蓄力时长，如果达到指定蓄力时长就选择对应SkillBlock。</li><li>开关技记录一下技能开关状态做不同的逻辑处理</li></ul><h4 id="InterruptSkill"><a href="#InterruptSkill" class="headerlink" title="InterruptSkill"></a>InterruptSkill</h4><p>打断技能，具体可配SkillBlock在技能的某时间段可被某种行为打断，做一个技能的衔接，一个角色的技能是否流程打断技能配置很关键。</p><p><img src="技能系统-主动技能/打断技能1.png" alt="img"></p><p>上图配置中<code>TotalTime</code>当前技能的持续时间，<code>xxTime</code>表示三段打断时间，<code>xxInterrupt</code> 表示打断技能的行为类型</p><p>移动打断，释放大招打断，普通攻击打断，使用技能打断等几种打断方式。</p><h3 id="SkillConditionComponent"><a href="#SkillConditionComponent" class="headerlink" title="SkillConditionComponent"></a>SkillConditionComponent</h3><h4 id="SkillCondition"><a href="#SkillCondition" class="headerlink" title="SkillCondition"></a>SkillCondition</h4><p><code>SkillCondition</code>条件基类封装一些条件检测通用的字段方法，如：条件类型，检测区域类型，检测范围半径，目标类型等字段，返回符合条件的目标，是否达成条件等方法，编辑器用的配置需要有读写xml的接口。所有扩展的条件都继承自<code>SkillCondition</code>。</p><p><code>SkillConditionComponent</code>主要职责是管理技能配置中所有<code>SkillCondition</code>，检测条件，对外提供检测结果的接口。传入条件id找到对应条件检测条件并返回结果。</p><p><img src="技能系统-主动技能/image.png" alt="img"></p><p>上图为检测角色身上被动技的条件。</p><p><img src="技能系统-主动技能/image-6.png" alt="img"></p><p>使用条件输入ConditionId，同时也实现了通过表达式来同时处理多个条件。</p><p>与、或、非（&amp; | ！）</p><p>[转载自][<a href="https://www.acgloby.com/技能系统程序设计思路-主动技能/]" target="_blank" rel="noopener">https://www.acgloby.com/技能系统程序设计思路-主动技能/]</a></p>]]></content>
      
      
      <categories>
          
          <category> 技能系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技能系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>技能系统-检测范围</title>
      <link href="/2022/01/02/%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F-%E6%A3%80%E6%B5%8B%E8%8C%83%E5%9B%B4/"/>
      <url>/2022/01/02/%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F-%E6%A3%80%E6%B5%8B%E8%8C%83%E5%9B%B4/</url>
      
        <content type="html"><![CDATA[<h4 id="矩形范围检测"><a href="#矩形范围检测" class="headerlink" title="矩形范围检测"></a>矩形范围检测</h4><p><a href="http://acgloby.com/wp-content/uploads/2021/10/矩形.png" target="_blank" rel="noopener"><img src="技能系统-检测范围/矩形.png" alt="img"></a></p><p>计算底边中点center，宽为2*range，长为length，朝向为q的矩形，是否与圆心为pos，半径为radius的圆有交点</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public bool IntersectsRectangle(Vector3 center, float length, float range, Quaternion q, Vector3 pos, float radius)</span><br><span class="line">{</span><br><span class="line">        Vector3 dis = pos - center;</span><br><span class="line">Vector3 forward = q * Vector3.forward;</span><br><span class="line">Vector3 right = q * Vector3.right;</span><br><span class="line">var vd = Vector3.Dot(dis, forward.normalized);</span><br><span class="line">var vl = Vector3.Dot(dis, right.normalized);</span><br><span class="line">return vd &gt; -radius &amp;&amp; vd &lt; length + radius &amp;&amp; vl &gt; -radius - range &amp;&amp; vl &lt; radius + range;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>计算中心点为center，高为height1的圆（柱），是否与底边中点为dst，高为height2的矩形（体）相交–只考虑高度</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public bool IntersectsHeight(Vector3 center, float radius, Vector3 dst, float height1, float height2)</span><br><span class="line">{</span><br><span class="line">var h = center.y - dst.y;</span><br><span class="line">if(h &gt;= 1e-6f)</span><br><span class="line">{</span><br><span class="line">        return h &lt;= height1 + height2;</span><br><span class="line">}</span><br><span class="line">        return Mathf.Abs(h) &lt; height1;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="圆形范围检测"><a href="#圆形范围检测" class="headerlink" title="圆形范围检测"></a>圆形范围检测</h4><p><a href="http://acgloby.com/wp-content/uploads/2021/10/圆形.png" target="_blank" rel="noopener"><img src="技能系统-检测范围/圆形.png" alt="img"></a></p><p>判断两个圆形中心点距离是否小于两个圆形半径和</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public bool IntersectsCircle(Vector3 center, Vector3 pos, float r1, float r2)</span><br><span class="line">{</span><br><span class="line">        var radius = r1 + r2;</span><br><span class="line">        Vector3 d = pos - center;</span><br><span class="line">        Vector2 v = new Vector2(d.x, d.z);</span><br><span class="line">        return v.sqrMagnitude &lt;= radius * radius;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="环形范围检测"><a href="#环形范围检测" class="headerlink" title="环形范围检测"></a>环形范围检测</h4><p><a href="http://acgloby.com/wp-content/uploads/2021/10/环形.png" target="_blank" rel="noopener"><img src="技能系统-检测范围/环形.png" alt="img"></a></p><p>判断外圆形和目标中心点距离是否小于两个圆形半径和，并且大于内圆和目标距离半径和</p><h4 id="扇形范围检测"><a href="#扇形范围检测" class="headerlink" title="扇形范围检测"></a>扇形范围检测</h4><p><a href="http://acgloby.com/wp-content/uploads/2021/10/扇形.png" target="_blank" rel="noopener"><img src="技能系统-检测范围/扇形.png" alt="img"></a></p><p>判断圆形和扇形是否相交在圆形检测的基础上计算施法者与目标之间的夹角是否在扇形二分之一角度内</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public bool IntersectsSector(Transform caster, Transform receiver, float angle, float radius)</span><br><span class="line">{</span><br><span class="line">Vector3 deltaA = caster.position - receiver.position;</span><br><span class="line">float tmpAngle = Mathf.Acos(Vector3.Dot(deltaA.normalized, caster.forward)) * Mathf.Rad2Deg;</span><br><span class="line">        return tmpAngle &lt; angle * 0.5f &amp;&amp; deltaA.magnitude &lt; radius;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><a href="https://www.acgloby.com/技能范围检测/" target="_blank" rel="noopener">转载自，侵删</a></p>]]></content>
      
      
      <categories>
          
          <category> 技能系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技能系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>技能系统-被动技能</title>
      <link href="/2022/01/02/%E8%A2%AB%E5%8A%A8%E6%8A%80%E8%83%BD-%E8%A2%AB%E5%8A%A8%E6%8A%80%E8%83%BD/"/>
      <url>/2022/01/02/%E8%A2%AB%E5%8A%A8%E6%8A%80%E8%83%BD-%E8%A2%AB%E5%8A%A8%E6%8A%80%E8%83%BD/</url>
      
        <content type="html"><![CDATA[<h2 id="被动技能（PassiveSkillEntity）-amp-光环技能（HaloSkillEntity）"><a href="#被动技能（PassiveSkillEntity）-amp-光环技能（HaloSkillEntity）" class="headerlink" title="被动技能（PassiveSkillEntity）&amp; 光环技能（HaloSkillEntity）"></a>被动技能（PassiveSkillEntity）&amp; 光环技能（HaloSkillEntity）</h2><p>被动技能有两种，一种是被动触发的技能，一种是光环技能在范围内才会生效的技能，所有被动技能继承自光环技能。</p><p>被动技算是一种特殊的光环技，没有范围的光环技。被动技能一般用来增加属性，增加buff之类的，也可以用作标记，只有在被动技触发时会释放效果列表。</p><p>光环技能有一个固定的范围（也不一定，可能会有技能效果会改变光环大小的效果ヾ(✿ﾟ▽ﾟ)ノ），进入光环时触发的效果，离开光环时的触发效果。</p><h3 id="被动技能触发器（事件系统）"><a href="#被动技能触发器（事件系统）" class="headerlink" title="被动技能触发器（事件系统）"></a>被动技能触发器（事件系统）</h3><p>被动技能选择触发条件，在Tick中检测触发器，满足时触发此被动技释放当被动技能触发的技能效果列表。</p><p>触发条件注册对应的事件（PassiveSkillEventType）在对应的系统上发送事件来触发被动技，如：当释放技能时触发被动，参数有技能id或者技能类型， 在CastSkill()释放技能时Push该事件，被动技能实时监测收到的事件满足条件触发对应的技能效果。</p><p>触发条件有生效次数、冷却时间来限制事件的触发。</p><p><img src="被动技能-被动技能/image-17-1024x321.png" alt="img"></p><p><img src="被动技能-被动技能/image-18.png" alt="img"></p><p>触发事件后释放被动技释放时的效果列表，如果没有添加事件对应加上该被动技就会触发该效果列表。</p><h2 id="光环技能"><a href="#光环技能" class="headerlink" title="光环技能"></a>光环技能</h2><p>光环技能与被动技不用在于光环技能会检测在光环范围内的目标，进入光环的时候释放效果，离开光环的时候释放效果，被动技能主要用在触发时释放效果。</p><p><img src="被动技能-被动技能/image-19.png" alt="img"></p><p><img src="被动技能-被动技能/image-20.png" alt="img"></p><p>如：光环目标类型是自己和伙伴，检测范围内的所有目标，筛选出符合目标的角色，放到一个列表内，进入光时添加一个无限时长buff，对应的离开光环时把这个buff驱散。</p><p>未完待续…</p><p>[转载自][<a href="https://www.acgloby.com/技能系统程序设计思路-被动技能/]" target="_blank" rel="noopener">https://www.acgloby.com/技能系统程序设计思路-被动技能/]</a></p>]]></content>
      
      
      <categories>
          
          <category> 技能系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技能系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Free_HDRSkybox</title>
      <link href="/2019/08/15/Free-HDRSkybox/"/>
      <url>/2019/08/15/Free-HDRSkybox/</url>
      
        <content type="html"><![CDATA[<p><a href="hdrihaven.com">HDR天空盒</a></p>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SkyBox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>依赖倒置原则</title>
      <link href="/2019/08/13/%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99/"/>
      <url>/2019/08/13/%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<h1 id="设计原则：依赖倒置原则"><a href="#设计原则：依赖倒置原则" class="headerlink" title="设计原则：依赖倒置原则"></a>设计原则：依赖倒置原则</h1><p>依赖倒置原则（Dependence Inversion Principle）是程序要依赖于抽象接口，不要依赖于具体实现。简单的说就是要求对抽象进行编程，不要对实现进行编程，这样就降低了客户与实现模块间的耦合。</p><p>总结：依赖倒置原则</p><ul><li>A.高层次的模块不应该依赖于低层次的模块，他们都应该依赖于抽象。</li><li>B.抽象不应该依赖于具体，具体应该依赖于抽象。</li></ul><h2 id="具体例子"><a href="#具体例子" class="headerlink" title="具体例子"></a>具体例子</h2><p>当在 Unity 设计底层模块时，上层模块调用的东西其实就只是一些暴露出来的方法，当底层改动的时候上层也需要改动，这就形成了高层次模块对低层次模块的依赖。这时候可以抽象出来这些需要暴露的方法，即使用接口抽象出来，使得底层依赖了抽象的接口，高层也依赖了抽象的接口，从而使得设计更加清爽。</p><p><a href="https://zhuanlan.zhihu.com/p/28401100" target="_blank" rel="noopener">浅谈Unity开发中的分层设计</a> 中也使用了接口抽象的方式，不过是在底层之间的相互依赖中使用了接口，对于上层还是通过暴露公共方法的方式，加了个 模块管理器，来取得具体模块或者具体实现的接口。</p><p><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/227328/1547347201283-d70ad1a3-3dc9-4b1c-8a60-5911580a7569.jpeg#align=left&amp;display=inline&amp;height=259&amp;originHeight=663&amp;originWidth=1116&amp;size=0&amp;width=436" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 设计原则 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计原则 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Design_Pattern_桥接模式</title>
      <link href="/2019/08/13/Design-Pattern-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/08/13/Design-Pattern-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="设计模式：桥接模式-Bridge-Pattern"><a href="#设计模式：桥接模式-Bridge-Pattern" class="headerlink" title="设计模式：桥接模式(Bridge Pattern)"></a>设计模式：桥接模式(Bridge Pattern)</h1><p>将类的功能层次结构和实现层次结构相分离，使二者能够独立地变化，并在两者之间搭建桥梁，实现桥接。它是一种对象结构型模式，又称为<strong>柄体(Handle and Body)模式</strong>或<strong>接口(Interfce)模式</strong>。</p><p><strong>意图：</strong>在一个软件系统的抽象化和实现化之间使用关联关系（组合或者聚合关系）而<strong>不是继承关系</strong>，从而使两者可以相对独立地变化。</p><ul><li>将类的功能层次分离开，父类拥有子类所共有的功能，子类里实现新的功能。</li><li>将类的实现层次分离开，父类声明抽象方法，子类来实现。</li></ul><p>桥接模式主要包含以下几个角色</p><ul><li><strong>Abstraction</strong>：抽象类，抽象了功能的实现。</li><li><strong>RefinedAbstraction</strong>：扩充抽象类实现了具体的新的功能，构成功能层次结构。</li><li><strong>Implementor</strong>：实现类接口，提供了用于抽象类的接口。</li><li><strong>ConcreteImplementor</strong>：具体实现类，构成实现层次结构。</li></ul><p><strong>现要画一个不同颜色不同形状组合的圆，把抽象化和实现分离开来使其能独立地变化</strong></p><p><strong>抽象类：</strong></p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Shape</span></span><br><span class="line">  {</span><br><span class="line">      <span class="keyword">public</span> Color color;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetColor</span>(<span class="params">Color color</span>)</span></span><br><span class="line"><span class="function"></span>      {</span><br><span class="line">          <span class="keyword">this</span>.color = color;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Draw</span>(<span class="params"></span>)</span>;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p><strong>扩充抽象类</strong></p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Circle</span> : <span class="title">Shape</span></span><br><span class="line">  {</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Draw</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>      {</span><br><span class="line">          color.BePaint(<span class="string">"圆"</span>);</span><br><span class="line">      }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Square</span> : <span class="title">Shape</span></span><br><span class="line">  {</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Draw</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>      {</span><br><span class="line">          color.BePaint(<span class="string">"正方形"</span>);</span><br><span class="line">      }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p><strong>实现类的接口：</strong></p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">Color</span></span><br><span class="line">  {</span><br><span class="line">     <span class="function"><span class="keyword">void</span> <span class="title">BePaint</span>(<span class="params"><span class="keyword">string</span> shape</span>)</span>;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p><strong>具体实现类:</strong></p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Red</span> : <span class="title">Color</span></span><br><span class="line">   {</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">BePaint</span>(<span class="params"><span class="keyword">string</span> shape</span>)</span></span><br><span class="line"><span class="function"></span>       {</span><br><span class="line">           Console.WriteLine(<span class="string">"红色的"</span> + shape);</span><br><span class="line">       }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Black</span> : <span class="title">Color</span></span><br><span class="line">   {</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">BePaint</span>(<span class="params"><span class="keyword">string</span> shape</span>)</span></span><br><span class="line"><span class="function"></span>       {</span><br><span class="line">           Console.WriteLine(<span class="string">"黑色的"</span> + shape);</span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure><p><strong>画出不同颜色不同形状的圆：</strong></p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Draw</span></span><br><span class="line">   {</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoDraw</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>       {</span><br><span class="line">           Color red = <span class="keyword">new</span> Red();</span><br><span class="line">           Color black = <span class="keyword">new</span> Black();</span><br><span class="line">           Shape circle = <span class="keyword">new</span> Circle();</span><br><span class="line"></span><br><span class="line">           <span class="comment">//画红色的圆</span></span><br><span class="line">           circle.SetColor(red);</span><br><span class="line">           circle.Draw();</span><br><span class="line"></span><br><span class="line">           <span class="comment">//画黑色的圆</span></span><br><span class="line">           circle.SetColor(black);</span><br><span class="line">           circle.Draw();</span><br><span class="line"></span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Design_Pattern_享元模式</title>
      <link href="/2019/08/13/Design-Pattern-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/08/13/Design-Pattern-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="设计模式：享元模式"><a href="#设计模式：享元模式" class="headerlink" title="设计模式：享元模式"></a>设计模式：享元模式</h1><h1 id="一、什么是享元模式？"><a href="#一、什么是享元模式？" class="headerlink" title="一、什么是享元模式？"></a>一、什么是享元模式？</h1><p><strong>享元模式（Flyweight）</strong>，运用共享技术有效地支持大量细粒度的对象。UML结构图如下：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/225637/1547115239417-4616bc5b-775f-4362-b2b2-0a165997e94b.png#align=left&amp;display=inline&amp;height=316&amp;name=%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8FUML%E5%9B%BE.png&amp;originHeight=316&amp;originWidth=634&amp;size=21131&amp;width=634" alt="享元模式UML图.png"></p><p>Flyweight是抽象享元角色。它是产品的抽象类，同时定义出对象的外部状态和内部状态的接口或实现；ConcreteFlyweight是具体享元角色，是具体的产品类，实现抽象角色定义的业务；<br>UnsharedConcreteFlyweight是不可共享的享元角色，一般不会出现在享元工厂中；<br>FlyweightFactory是享元工厂，它用于构造一个池容器，同时提供从池中获得对象的方法。</p><h1 id="二、内部状态与外部状态的区分"><a href="#二、内部状态与外部状态的区分" class="headerlink" title="二、内部状态与外部状态的区分"></a>二、内部状态与外部状态的区分</h1><p>享元享元，共享细粒度的单元。那么什么是细粒度的单元呢？如果用乐高积木作比喻，那么一个积木人可以称为一个完整的对象。如果我们把积木人拆开，可以进一步得到头、身躯，腿三个部分。而这些部分，相比于完整的积木人而言，它们三个就是细粒度的单元。</p><p>那么为什么要把一个完整的对象区分内外部呢？这岂不是增加了代码的复杂度？好，我们暂时搁置，接下来思考这样一个问题，如果我们要创造 10 个积木人，用程序怎么表示呢？</p><p>我们先创建一个积木人的类，如下：</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LegoMan</span></span><br><span class="line">{</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">string</span> Head;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">string</span> Torso;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">string</span> Leg;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LegoMan</span>(<span class="params"><span class="keyword">string</span> head, <span class="keyword">string</span> torso, <span class="keyword">string</span> leg</span>)</span></span><br><span class="line"><span class="function"></span>  {</span><br><span class="line">    <span class="keyword">this</span>.Head = head;</span><br><span class="line">    <span class="keyword">this</span>.Torso = torso;</span><br><span class="line">    <span class="keyword">this</span>.Leg = leg;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>接着我们开始创造积木人，先采用直接 new 的方式：</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Example</span> {</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">      LegoMan man1 = <span class="keyword">new</span> LegoMan(<span class="string">"head1"</span>, <span class="string">"torso1"</span>, <span class="string">"leg1"</span>);</span><br><span class="line">      LegoMan man2 = <span class="keyword">new</span> LegoMan(<span class="string">"head2"</span>, <span class="string">"torso2"</span>, <span class="string">"leg2"</span>);</span><br><span class="line">      ...</span><br><span class="line">      LegoMan man10 = <span class="keyword">new</span> LegoMan(<span class="string">"head10"</span>, <span class="string">"torso10"</span>, <span class="string">"leg10"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>现在我们得到了 10 个积木人，接下来我们对积木人作出一些限制，我们现在需要 10 个士兵积木人，由于士兵的制服统一，那么这一百个积木人的下半身是完全一样的，也就是说除了 Head，积木人的 Torso 和 Leg 都是一样的。现在我们继续创建十个士兵积木人。好吧，和上面的例子一样，只是传入的后两个参数均一致。</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LegoMan manN = <span class="keyword">new</span> LegoMan(<span class="string">"headN"</span>, <span class="string">"torsoStandard"</span>, <span class="string">"legStandard"</span>)</span><br></pre></td></tr></tbody></table></figure><p>接下来，我们思考这样一个问题，如果需要 1000 个士兵积木人呢？如果采用一般的方式，需要创建 1000 个实例对象，但是这 1000 个对象都有着共同的部分，就是它们的 Torso 和 Leg。那我们可不可以把共同的部分抽取出来呢？当然可以，现在我们把 Torso 和 Leg 整合为一个 Body 类，如下：</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Body</span></span><br><span class="line">{</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">string</span> Torso;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">string</span> Leg;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Body</span>(<span class="params"><span class="keyword">string</span> torso, <span class="keyword">string</span> leg</span>)</span></span><br><span class="line"><span class="function"></span>  {</span><br><span class="line">    <span class="keyword">this</span>.Torso = torso;</span><br><span class="line">    <span class="keyword">this</span>.Leg = leg;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>既然 Body 被提取出来了，那么 LegoMan 这个类也要被重写了，如下：</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LegoMan</span></span><br><span class="line">{</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">string</span> Head;</span><br><span class="line">  <span class="keyword">public</span> Body BodyIntrinsic;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LegoMan</span>(<span class="params"><span class="keyword">string</span> head, Body body</span>)</span></span><br><span class="line"><span class="function"></span>  {</span><br><span class="line">    <span class="keyword">this</span>.Head = head;</span><br><span class="line">    <span class="keyword">this</span>.BodyIntrinsic = body;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>现在我们再来创建 1000 个积木人士兵的话，应该是这样：</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Example</span> {</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">      <span class="comment">//先创建一个通用的 Body </span></span><br><span class="line">      Body bodyStandard = <span class="keyword">new</span> Body(<span class="string">"torsoStandard"</span>, <span class="string">"legStandard"</span>);</span><br><span class="line">      </span><br><span class="line">      LegoMan man1 = <span class="keyword">new</span> LegoMan(<span class="string">"head1"</span>, bodyStandard);</span><br><span class="line">      LegoMan man2 = <span class="keyword">new</span> LegoMan(<span class="string">"head2"</span>, bodyStandard);</span><br><span class="line">      ...</span><br><span class="line">      LegoMan man1000 = <span class="keyword">new</span> LegoMan(<span class="string">"head1000"</span>, bodyStandard);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>发现了吗？现在虽然也是1000个 LegoMan 的实例，但是却只有一个 Body，也就是说，1000个积木人士兵 的 Head，共享了一个 Body。听起来很疯狂，九头蛇也才九头，一千个头的怪物得多可怕！？哈哈，虽然积木人的玩具不可能这么拼，但是程序里，这种共享机制是可行的。Body 就是享元模式中的内部状态，一个重复度很高的细粒度单元。而 Head 则对应外部状态，会随着需求发生变化。这么分离的好处也很明显，就是大大减少了总数据量。如果不分离内外部，创建 1000 个积木人士兵的成本就是1000个 Head 和1000个 Body，而采用分离策略后，就只需要1000个 Head 外加1个 Body了。当随着创建对象数量级的增大，这种策略带来的好处会越来越明显。</p><h1 id="三、完整的享元模式"><a href="#三、完整的享元模式" class="headerlink" title="三、完整的享元模式"></a>三、完整的享元模式</h1><p>理解了分离内外部的原因后，下面简单实现一下享元模式</p><h2 id="1-Flyweight抽象类"><a href="#1-Flyweight抽象类" class="headerlink" title="1.Flyweight抽象类"></a>1.Flyweight抽象类</h2><p>通过最上面的 UML 图可以看出，Flyweight 被分为两部分，ConcreteFlyweight（共享的内部）和UnsharedConcreteFlyweight（不可共享的外部）。所以 Flyweight 最好被做成接口，或者抽象类，这里用抽象类实现，如下：</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Flyweight</span> </span><br><span class="line">{</span><br><span class="line">    <span class="comment">//内部状态</span></span><br><span class="line">    <span class="keyword">public</span> String intrinsic;</span><br><span class="line">    <span class="comment">//外部状态</span></span><br><span class="line">    <span class="keyword">public</span> String extrinsic;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//要求享元角色必须接受外部状态</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Flyweight</span>(<span class="params">String extrinsic</span>) </span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">this</span>.extrinsic = extrinsic;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定义业务操作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Operate</span>(<span class="params"><span class="keyword">int</span> extrinsic</span>)</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="2-ConcreteFlyweight类"><a href="#2-ConcreteFlyweight类" class="headerlink" title="2. ConcreteFlyweight类"></a>2. ConcreteFlyweight类</h2><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConcreteFlyweight</span> : <span class="title">Flyweight</span> </span><br><span class="line">{</span><br><span class="line">    <span class="comment">//接受外部状态</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteFlyweight</span>(<span class="params">String extrinsic</span>):<span class="title">base</span>(<span class="params">extrinsic</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        Debug.Log(<span class="string">"共享的 "</span> + extrinsic);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据外部状态进行逻辑处理</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Operate</span>(<span class="params"><span class="keyword">string</span> extrinsic</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        Debug.Log(<span class="string">"处理共享数据 "</span> + extrinsic);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="3-UnsharedConcreteFlyweight类"><a href="#3-UnsharedConcreteFlyweight类" class="headerlink" title="3. UnsharedConcreteFlyweight类"></a>3. UnsharedConcreteFlyweight类</h2><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UnsharedConcreteFlyweight</span> : <span class="title">Flyweight</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnsharedConcreteFlyweight</span>(<span class="params">String extrinsic</span>):<span class="title">base</span>(<span class="params">extrinsic</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        Debug.Log(<span class="string">"非共享的 "</span> + extrinsic);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Operate</span>(<span class="params"><span class="keyword">int</span> extrinsic</span>) </span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        Debug.Log(<span class="string">"处理非共享数据 "</span> + extrinsic);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="4-FlyweightFactory类"><a href="#4-FlyweightFactory类" class="headerlink" title="4. FlyweightFactory类"></a>4. FlyweightFactory类</h2><p>既然是处理大量数据，那免不了用一个对象池来进行管理，如下：</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FlyweightFactory</span> </span><br><span class="line">{</span><br><span class="line">    <span class="comment">//定义一个池容器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Flyweight&gt; pool = <span class="keyword">new</span> List&lt;Flyweight&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//享元工厂</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Flyweight <span class="title">GetFlyweight</span>(<span class="params">String extrinsic</span>) </span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">var</span> flyweight = pool.Find(obj =&gt; obj.extrinsic == extrinsic);</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span> (flyweight == <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            flyweight = <span class="keyword">new</span> ConcreteFlyweight(extrinsic);</span><br><span class="line">            pool.Add(flyweight);</span><br><span class="line">            Debug.Log(<span class="string">"新创建 "</span> + extrinsic);</span><br><span class="line">        }</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      {</span><br><span class="line">          Debug.Log(<span class="string">"从池中取出 "</span> + extrinsic);</span><br><span class="line">      }</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">return</span> flyweight;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="5-客户端的调用"><a href="#5-客户端的调用" class="headerlink" title="5.客户端的调用"></a>5.客户端的调用</h2><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Client</span> {</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        Flyweight flyweight1 = FlyweightFactory.GetFlyweight(<span class="string">"one"</span>);</span><br><span class="line">        flyweight1.Operate(<span class="string">"one"</span>);</span><br><span class="line">        </span><br><span class="line">        Flyweight flyweight2 = FlyweightFactory.GetFlyweight(<span class="string">"two"</span>);</span><br><span class="line">        flyweight2.Operate(<span class="string">"two"</span>);</span><br><span class="line">        </span><br><span class="line">        Flyweight flyweight3 = FlyweightFactory.getFlyweight(<span class="string">"one"</span>);</span><br><span class="line">        flyweight3.Operate(<span class="string">"one"</span>);</span><br><span class="line">        </span><br><span class="line">        Flyweight unsharedFlyweight = <span class="keyword">new</span> UnsharedConcreteFlyweight(<span class="string">"one"</span>);</span><br><span class="line">        unsharedFlyweight.operate(<span class="string">"one"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>打印结果如下：<br>新创建 one<br>处理共享数据 one<br>新创建 two<br>处理共享数据 two<br>从池中取出 one<br>处理共享数据 one<br>非共享的 one<br>处理非共享数据 one</p><p>参考博客：<br><a href="https://www.cnblogs.com/adamjwh/p/9070107.html" target="_blank" rel="noopener">https://www.cnblogs.com/adamjwh/p/9070107.html</a><br><a href="https://blog.csdn.net/justloveyou_/article/details/55045638" target="_blank" rel="noopener">https://blog.csdn.net/justloveyou_/article/details/55045638</a></p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Design_Pattern_命令模式</title>
      <link href="/2019/08/13/Design-Pattern-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/08/13/Design-Pattern-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="设计模式：命令模式"><a href="#设计模式：命令模式" class="headerlink" title="设计模式：命令模式"></a>设计模式：命令模式</h1><p><strong>命令模式在GoF中的定义是：</strong></p><blockquote><p>将一个请求封装为一个对象，从而使你可用不同的请求对客户进行参数化； 对请求排队或记录请求日志，以及支持可撤销的操作。<br>命令模式是一种回调的面向对象实现。</p></blockquote><p><strong>游戏设计模式里把它精简为：</strong></p><blockquote><p>命令是具现化的方法调用。</p></blockquote><p>两种术语都意味着将概念变成数据一个对象可以存储在变量中，传给函数。<br>所以称命令模式为“具现化方法调用”，意思是方法调用被存储在对象中。<br>类似C#里的回调<br>把一个对象传递到方法中，让方法内部解析。</p><p>下面是一个C#版本的角色控制，传入一个角色，就能调用对应的各种行动。</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 命令基类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Command</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">BaseCharacter character</span>)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 跳的命令</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JumpCommand</span> : <span class="title">Command</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">BaseCharacter character</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        character.Jump();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 射击的命令</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FireCommand</span> : <span class="title">Command</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">BaseCharacter character</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        character.Fire();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 移动的命令</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MoveCommand</span> : <span class="title">Command</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">BaseCharacter character</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 对输入的解析</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">InputHandler</span></span><br><span class="line">{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JumpCommand buttonA;</span><br><span class="line">    <span class="keyword">private</span> FireCommand buttonD;</span><br><span class="line">    <span class="keyword">private</span> MoveCommand buttonW;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Command <span class="title">HandleInputAction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.A)) { <span class="keyword">return</span> buttonA; }</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.D)) { <span class="keyword">return</span> buttonD; }</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.W)) { <span class="keyword">return</span> buttonW; }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Player mPlayer;</span><br><span class="line">    <span class="keyword">private</span> Enemy mEnemy;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Command</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        Command command = HandleInputAction();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (command != <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            command.Execute(mPlayer);</span><br><span class="line">            command.Execute(mEnemy);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Player</span> : <span class="title">BaseCharacter</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Fire</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">base</span>.Fire();</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Jump</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">base</span>.Jump();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Enemy</span> : <span class="title">BaseCharacter</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Fire</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">base</span>.Fire();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 角色的基类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">BaseCharacter</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Jump</span>(<span class="params"></span>)</span> { }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Fire</span>(<span class="params"></span>)</span> { }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Design_Pattern_状态模式</title>
      <link href="/2019/08/13/Design-Pattern-%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/08/13/Design-Pattern-%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="设计模式：状态模式（有限、分层和下推状态机）"><a href="#设计模式：状态模式（有限、分层和下推状态机）" class="headerlink" title="设计模式：状态模式（有限、分层和下推状态机）"></a>设计模式：状态模式（有限、分层和下推状态机）</h1><p>实现了最简单的有限状态机</p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FSM</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> MonoStateMachine monoStateMachine = <span class="keyword">new</span> MonoStateMachine();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> RunState RunState;</span><br><span class="line">    <span class="keyword">public</span> IdleState IdleState;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        monoStateMachine.StartState(RunState);</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        monoStateMachine.Update();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RunState</span> : <span class="title">MonoState</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RunState instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RunState <span class="title">Instance</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            instance = <span class="keyword">new</span> RunState();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        Debug.Log(<span class="string">"进入跑步"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        Debug.Log(<span class="string">"开始跑步"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Exit</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        Debug.Log(<span class="string">"退出跑步"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">IdleState</span> : <span class="title">MonoState</span></span><br><span class="line">{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IdleState instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IdleState <span class="title">Instance</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            instance = <span class="keyword">new</span> IdleState();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Exit</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MonoState</span> </span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Enter</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Exit</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MonoStateMachine</span></span><br><span class="line">{</span><br><span class="line">   <span class="comment">// private MonoState mOwner;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MonoState mCurrentState;</span><br><span class="line">    <span class="keyword">private</span> MonoState mPreviousState;</span><br><span class="line">    <span class="keyword">private</span> MonoState mGlobalState;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MonoStateMachine</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        mCurrentState = <span class="literal">null</span>;</span><br><span class="line">        mPreviousState = <span class="literal">null</span>;</span><br><span class="line">        mGlobalState = <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 设置初始状态</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="state"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartState</span>(<span class="params">MonoState state</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        mCurrentState = state <span class="keyword">as</span> MonoState;</span><br><span class="line">        mCurrentState.Enter();</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChangeState</span>(<span class="params">MonoState state</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">if</span> (state == <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            Debug.Log(<span class="string">"无法找到此状态"</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        mPreviousState = mCurrentState;</span><br><span class="line">        mCurrentState.Exit();</span><br><span class="line">        <span class="comment">//转换后</span></span><br><span class="line">        mCurrentState = state <span class="keyword">as</span> MonoState;</span><br><span class="line">        mCurrentState.Enter();</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 还原之前的状态</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RevertToPreviouState</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        ChangeState(mPreviousState);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 得到当前状态</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MonoState <span class="title">GetCurrentState</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">return</span> mCurrentState;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 得到之前的状态</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MonoState <span class="title">GetPreviousState</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">return</span> mPreviousState;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">if</span> (mCurrentState!=<span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            mCurrentState.Execute();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Design_Pattern_单例</title>
      <link href="/2019/08/13/Design-Pattern-%E5%8D%95%E4%BE%8B/"/>
      <url>/2019/08/13/Design-Pattern-%E5%8D%95%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h1><ul><li>单例为最常见的一种设计模式，目前在用的主要有两种方式，一种是基于Unity的，一种是基于C#的</li><li>一般来说，unity里的单例分为两种，一种是继承于Monobehaviour的，一种是不继承于它的；</li><li>这里给出了两种实现方法</li></ul><p><strong>使用Unity里的方法</strong></p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">public abstract class ScriptSingleton&lt;T&gt;  : MonoBehaviour where T : ScriptSingleton&lt;T&gt;</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">static</span> T _instance;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> T Instance</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span> (_instance == <span class="literal">null</span>)</span><br><span class="line">                {</span><br><span class="line">                    <span class="comment">//从场景中找T脚本的对象</span></span><br><span class="line">                    _instance = FindObjectOfType&lt;T&gt;();</span><br><span class="line">                    <span class="keyword">if</span> (FindObjectsOfType&lt;T&gt;().Length &gt; <span class="number">1</span>)</span><br><span class="line">                    {</span><br><span class="line">                        Debug.LogError(<span class="string">"场景中的单例脚本数量 &gt; 1:"</span> + _instance.GetType().ToString());</span><br><span class="line">                        <span class="keyword">return</span> _instance;</span><br><span class="line">                    }</span><br><span class="line">                    <span class="comment">//场景中找不到的情况</span></span><br><span class="line">                    <span class="keyword">if</span> (_instance == <span class="literal">null</span>)</span><br><span class="line">                    {</span><br><span class="line">                        <span class="keyword">string</span> instanceName = <span class="keyword">typeof</span>(T).Name;</span><br><span class="line">                        GameObject instanceGO = GameObject.Find(instanceName);</span><br><span class="line">                        <span class="keyword">if</span> (instanceGO == <span class="literal">null</span>)</span><br><span class="line">                        {</span><br><span class="line">                            instanceGO = <span class="keyword">new</span> GameObject(instanceName);</span><br><span class="line">                            DontDestroyOnLoad(instanceGO);</span><br><span class="line">                            _instance = instanceGO.AddComponent&lt;T&gt;();</span><br><span class="line">                            DontDestroyOnLoad(_instance);</span><br><span class="line">                        }</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                        {</span><br><span class="line">                            <span class="comment">//场景中已存在同名游戏物体时就打印提示</span></span><br><span class="line">                            Debug.LogError(<span class="string">"场景中已存在单例:"</span> + instanceGO.name);</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">return</span> _instance;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">         <span class="function"><span class="keyword">void</span> <span class="title">OnDestroy</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            _instance = <span class="literal">null</span>;</span><br><span class="line">        }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>通过反射实现的单例</strong></p><figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Singleton&lt;T&gt; where T : Singleton&lt;T&gt; </span><br><span class="line">{ </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> T mInstance = <span class="literal">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">Singleton</span>(<span class="params"></span>)</span> { }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> T Instance </span><br><span class="line">    { </span><br><span class="line">        <span class="keyword">get</span> </span><br><span class="line">        { </span><br><span class="line">            <span class="keyword">if</span> (mInstance == <span class="literal">null</span>)</span><br><span class="line">            {</span><br><span class="line">                 <span class="keyword">var</span> ctors = <span class="keyword">typeof</span>(T).GetConstructors(BindingFlags.Instance | BindingFlags.NonPublic);  </span><br><span class="line">                <span class="keyword">var</span> ctor = Array.Find(ctors, c =&gt; c.GetParameters().Length == <span class="number">0</span>); </span><br><span class="line">                <span class="keyword">if</span> (ctor == <span class="literal">null</span>) </span><br><span class="line">                {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"Non-public ctor() not found!"</span>); </span><br><span class="line">                }</span><br><span class="line">                 mInstance = ctor.Invoke(<span class="literal">null</span>) <span class="keyword">as</span> T; }</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> mInstance;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Stencil_Test</title>
      <link href="/2019/08/10/Stencil-Test/"/>
      <url>/2019/08/10/Stencil-Test/</url>
      
        <content type="html"><![CDATA[<h4 id="模板测试-Stencil-Test-相关"><a href="#模板测试-Stencil-Test-相关" class="headerlink" title="模板测试(Stencil Test)相关"></a>模板测试(Stencil Test)相关</h4><h5 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h5><p>模板测试一般发生在深度测试前，在片段着色器处理完一个片段后执行。和深度测试一样也会丢弃片元。模板测试是根据一个缓冲来进行的，它叫做模板缓冲(Stencil Buffer)</p><p>一个模板缓冲中，（通常）每个模板值(Stencil Value)是8位的。所以每个像素/片段一共能有256种不同的模板值。我们可以将这些模板值设置为我们想要的值，然后当某一个片段有某一个模板值的时候，我们就可以选择丢弃或是保留这个片段了。</p><h5 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h5><p>模板缓冲操作允许我们在渲染片段时将模板缓冲设定为一个特定的值。通过在渲染时修改模板缓冲的内容，我们写入了模板缓冲。在同一个（或者接下来的）渲染迭代中，我们可以读取这些值，来决定丢弃还是保留某个片段。使用模板缓冲的时候你可以尽情发挥，但大体的步骤如下：</p><ul><li>启用模板缓冲的写入。</li><li>渲染物体，更新模板缓冲的内容。</li><li>禁用模板缓冲的写入。</li><li>渲染（其它）物体，这次根据模板缓冲的内容丢弃特定的片段。</li></ul><p>所以，通过使用模板缓冲，我们可以根据场景中已绘制的其它物体的片段，来决定是否丢弃特定的片段。</p><h5 id="具体案例"><a href="#具体案例" class="headerlink" title="具体案例"></a>具体案例</h5><p>一般来说，stencil完整的语法如下</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">stencil</span><br><span class="line">{</span><br><span class="line">    Ref referenceValue</span><br><span class="line">    ReadMask  readMask</span><br><span class="line">    WriteMask writeMask</span><br><span class="line">    Comp comparisonFunction</span><br><span class="line">    Pass stencilOperation</span><br><span class="line">    Fail stencilOperation</span><br><span class="line">    ZFail stencilOperation</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>我们可以用模板缓冲来实现一个物体轮廓，步骤如下：</p><ol><li>在绘制（需要添加轮廓的）物体之前，将模板函数设置为GL_ALWAYS，每当物体的片段被渲染时，将模板缓冲更新为1。</li><li>渲染物体。</li><li>禁用模板写入以及深度测试。</li><li>将每个物体缩放一点点。</li><li>使用一个不同的片段着色器，输出一个单独的（边框）颜色。</li><li>再次绘制物体，但只在它们片段的模板值不等于1时才绘制。</li><li>再次启用模板写入和深度测试。</li></ol><p>这个过程将每个物体的片段的模板缓冲设置为1，当我们想要绘制边框的时候，我们主要绘制放大版本的物体中模板测试通过的部分，也就是物体的边框的位置。我们主要使用模板缓冲丢弃了放大版本中属于原物体片段的部分。</p>]]></content>
      
      
      <categories>
          
          <category> 图形学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图形学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Culling</title>
      <link href="/2019/08/10/Culling/"/>
      <url>/2019/08/10/Culling/</url>
      
        <content type="html"><![CDATA[<h4 id="面剔除（Culling）"><a href="#面剔除（Culling）" class="headerlink" title="面剔除（Culling）"></a>面剔除（Culling）</h4><p>​    一个3DCube我们最多只能看到3个面，那多余的几个面就能丢弃它，能节省片段着色器的执行数，这就是面剔除（Culling），我们可以分析顶点数据的环绕顺序(Winding Order)来区分正面和背面，而反面在绝大多数情况下是不用渲染的。</p><h5 id="在Unity中Cull有三种用于控制几何体的哪一面会被剔除"><a href="#在Unity中Cull有三种用于控制几何体的哪一面会被剔除" class="headerlink" title="在Unity中Cull有三种用于控制几何体的哪一面会被剔除"></a>在Unity中Cull有三种用于控制几何体的哪一面会被剔除</h5><p><strong>Cull Back || Front || Off</strong></p><ul><li>Cull Back——不渲染多边形的背面（默认）。</li><li>Cull Front——不渲染多边形的正面。这将看到原来被正面遮挡的背面内容。</li><li>Cull Off——禁用剔除，两个面都会被绘制。同于一些特殊的效果。（一般用于绘制比较薄的对象，如：纸）</li></ul><h5 id="默认情况下，逆时针顶点所定义的三角形将会被处理为正向三角形。"><a href="#默认情况下，逆时针顶点所定义的三角形将会被处理为正向三角形。" class="headerlink" title="默认情况下，逆时针顶点所定义的三角形将会被处理为正向三角形。"></a>默认情况下，逆时针顶点所定义的三角形将会被处理为正向三角形。</h5><p>观察者所面向的所有三角形顶点就是我们所指定的正确环绕顺序了，而立方体另一面的三角形顶点则是以相反的环绕顺序所渲染的。这样的结果就是，我们所面向的三角形将会是正向三角形，而背面的三角形则是背向三角形。如下图：</p><p><img src="https://i.loli.net/2019/07/18/5d2f478fdbecc46253.png" alt=""></p><p>​    在顶点数据中，我们将两个三角形都以逆时针顺序定义（正面的三角形是1、2、3，背面的三角形也是1、2、3（如果我们从正面看这个三角形的话））。然而，如果从观察者当前视角使用1、2、3的顺序来绘制的话，从观察者的方向来看，背面的三角形将会是以顺时针顺序渲染的。虽然背面的三角形是以逆时针定义的，它现在是以顺时针顺序渲染的了。这正是我们想要剔除（Cull，丢弃）的不可见面了</p>]]></content>
      
      
      <categories>
          
          <category> 图形学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图形学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Blending</title>
      <link href="/2019/08/10/Blending/"/>
      <url>/2019/08/10/Blending/</url>
      
        <content type="html"><![CDATA[<h4 id="混合-Blending"><a href="#混合-Blending" class="headerlink" title="混合(Blending)"></a>混合(Blending)</h4><p>混合(Blending)通常是实现物体透明度(Transparency)的一种技术。</p><p>在Unity中提供了渲染队列来实现透明效果，使用SubShader的Queue标签决定渲染队列，索引越小越早渲染。</p><table><thead><tr><th>Background</th><th>索引</th><th>效果</th></tr></thead><tbody><tr><td>Background</td><td>1000</td><td>最先绘制，通常绘制背景</td></tr><tr><td>Geometry</td><td>2000</td><td>默认</td></tr><tr><td>AlphaTest</td><td>2450</td><td>需要透明度测试使用此队列</td></tr><tr><td>Transparent</td><td>3000</td><td>从后往前渲染，透明度混合使用此队列</td></tr><tr><td>Overlay</td><td>4000</td><td>实现叠加效果</td></tr></tbody></table><p>Unity中实现物体透明分全透明和半透明两种：</p><ol><li><p>透明度测试（全透明），给定一个值，不满足条件的都将被舍弃</p><p>函数： void clip (float x)</p><p>例如：</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">clip(float x);</span><br><span class="line">if(x&lt;0.5f){  //舍弃小于0.5的片元</span><br><span class="line">    discard;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>透明度混合（半透明），Blend是Unity提供的设置混合模式的命令。想要实现半透明的效果就需要把当前自身的颜色和已经存在的颜色缓冲中的颜色值进行混合。</p><p>一般的混合都是通过以下方程来实现：</p><p><img src="https://i.loli.net/2019/07/13/5d29cc8754c2f30953.png" alt=""></p><ul><li>C source：源颜色向量。这是源自纹理的颜色向量。</li><li>C destination：目标颜色向量。这是当前储存在颜色缓冲中的颜色向量。</li><li>F source：源因子值。指定了alpha值对源颜色的影响。</li><li>F destination：目标因子值。指定了alpha值对目标颜色的影响。</li></ul><p>例如：要实现红和绿两种颜色的混合</p><p><img src="https://i.loli.net/2019/07/13/5d29cd84b9aa434910.png" alt=""></p><p>结果就是重叠方形的片段包含了一个60%绿色，40%红色的一种脏兮兮的颜色：</p><p><img src="https://i.loli.net/2019/07/13/5d29cdb288de887569.png" alt=""></p></li></ol><p>​        要想让混合在多个物体上工作，我们需要最先绘制最远的物体，最后绘制最近的物体。普通不需要混合的物体仍然可以使用深度缓冲正常绘制，所以它们不需要排序。但我们仍要保证它们在绘制（排序的）透明物体之前已经绘制完毕了。当绘制一个有不透明和透明物体的场景的时候，大体的原则如下：</p><ol><li>先绘制所有不透明的物体。</li><li>对所有透明的物体排序。</li><li>按顺序绘制所有透明的物体。</li></ol><p>在Unity中为了得到透明物体的排序我们需要开启深度写入，但这会使透明无法进行，所以需要两个Pass来渲染，第一个开启深度写入，但不输出颜色，第二个Pass进行正常的透明度混合。</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Pass{</span><br><span class="line">    ZWrite On</span><br><span class="line">    ColorMask 0</span><br><span class="line">}</span><br><span class="line">Pass{</span><br><span class="line">    //混合颜色</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 图形学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图形学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity记录</title>
      <link href="/2019/07/17/Unity%E8%AE%B0%E5%BD%95/"/>
      <url>/2019/07/17/Unity%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<ul><li><p>相同的材质，属性不同，避免创建新的材质</p><p><strong>MaterialPropertyBlock</strong></p></li></ul><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//会创建一个新的材质</span><br><span class="line">meshRenderer.material.color = clolr;</span><br><span class="line">//不会创建一个新的材质</span><br><span class="line">var propertyBlock = new MaterialPropertyBlock();</span><br><span class="line">propertyBlock.SetColor("_Color", color);</span><br><span class="line">meshRenderer.SetPropertyBlock(propertyBlock);</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ZTest</title>
      <link href="/2019/07/12/ZTest/"/>
      <url>/2019/07/12/ZTest/</url>
      
        <content type="html"><![CDATA[<h3 id="深度测试相关（ZTest）"><a href="#深度测试相关（ZTest）" class="headerlink" title="深度测试相关（ZTest）"></a>深度测试相关（ZTest）</h3><p>在不使用深度测试的时候，如果我们先绘制一个距离较近的物体，再绘制距离较远的物体，则距离远的物体因为后绘制，会把距离近的物体覆盖掉，这样的效果并不是我们所希望的。而有了深度缓冲以后，绘制物体的顺序就不那么重要了，都能按照远近（Z值）正常显示，这很关键。</p><h4 id="深度"><a href="#深度" class="headerlink" title="深度"></a>深度</h4><p>深度为该像素点离摄像机的距离（z值），存在深度缓冲中，通常会以16、24、32位float来存储，精度越高越精确。通常为24位</p><h4 id="深度测试"><a href="#深度测试" class="headerlink" title="深度测试"></a>深度测试</h4><p>将该像素点的z值对比G-Buffer的值，通过则更新为新的深度值，测试失败则丢弃该片段</p><h4 id="深度缓冲"><a href="#深度缓冲" class="headerlink" title="深度缓冲"></a>深度缓冲</h4><p>深度缓冲中存着深度数据，由于深度缓冲是在片段着色器运行后在屏幕空间进行，现在大部分的GPU都提供一个叫做提前深度测试(Early Depth Testing)的硬件特性。提前深度测试允许深度测试在片段着色器之前运行。只要我们清楚一个片段永远不会是可见的（它在其他物体之后），我们就能提前丢弃这个片段。</p><h4 id="深度值精度"><a href="#深度值精度" class="headerlink" title="深度值精度"></a>深度值精度</h4><p>深度缓冲包含一个介于0.0和1.0之前的值，里面存着深度值为距离摄像机的距离，但几乎永远不会使用这样的线性深度缓冲(Linear Depth Buffer)的。要想有正确的投影性质，需要使用一个非线性的深度方程，它是与 1/z 成正比的。它做的就是在z值很小的时候提供非常高的精度，而在z值很远的时候提供更少的精度。这样才能更大的利用深度值的精度。</p><p>由于非线性方程与 1/z 成正比，在1.0和2.0之间的z值将会变换至1.0到0.5之间的深度值，这就是一个float提供给我们的一半精度了，这在z值很小的情况下提供了非常大的精度。在50.0和100.0之间的z值将会只占2%的float精度，这正是我们所需要的。这样的一个考虑了远近距离的方程是这样的：</p><p><img src="https://i.loli.net/2019/07/09/5d24b2e0ecc0249057.png" alt=""></p><p>变成图大概是这样</p><p><img src="https://i.loli.net/2019/07/09/5d24b30817a6873744.png" alt=""></p><h4 id="深度冲突"><a href="#深度冲突" class="headerlink" title="深度冲突"></a>深度冲突</h4><p>一个很常见的错误是俩个平面紧密贴在一起时，深度缓冲没有足够的精度来决定谁在前面，就会出现交替闪烁的现象，叫深度冲突(Z-fighting)</p><p>抗深度冲突技术中，最简单的就是使用更高的精度深度缓冲，会牺牲掉一些性能，却能获得更好的效果。</p>]]></content>
      
      
      <categories>
          
          <category> 图形学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图形学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简单UI框架</title>
      <link href="/2019/07/09/%E7%AE%80%E5%8D%95UI%E6%A1%86%E6%9E%B6/"/>
      <url>/2019/07/09/%E7%AE%80%E5%8D%95UI%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<p>简单的UI框架，方便以后复制</p><figure class="highlight c#"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.EventSystems;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">IL</span></span><br><span class="line">{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> UILevel</span><br><span class="line">    {</span><br><span class="line">        Bottom,<span class="comment">//底层</span></span><br><span class="line">        Common, <span class="comment">//普通层</span></span><br><span class="line">        Top,<span class="comment">//最前层</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public class UIMgr : ASingleton&lt;UIMgr&gt;</span><br><span class="line">    {</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Dictionary&lt;<span class="keyword">string</span>, PanelView&gt; mAllPanel = <span class="keyword">new</span> Dictionary&lt;<span class="keyword">string</span>, PanelView&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Transform mBottomTrans;</span><br><span class="line">        <span class="keyword">private</span> Transform mCommonTrans;</span><br><span class="line">        <span class="keyword">private</span> Transform mTopTrans;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Canvas mCanvas;</span><br><span class="line">        <span class="keyword">private</span> CanvasScaler mCanvasScaler;</span><br><span class="line">        <span class="keyword">private</span> GraphicRaycaster mGraphicRaycaster;</span><br><span class="line">        <span class="keyword">private</span> RectTransform mRectTransform;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> EventSystem mEventSystem;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Transform UIRoot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            UIRoot = GameObject.Instantiate(ResMgr.Ins.Load&lt;GameObject&gt;(AssetBundleName.UI,<span class="string">"uiroot"</span>)).transform;</span><br><span class="line">            GameObject.DontDestroyOnLoad(UIRoot);</span><br><span class="line"></span><br><span class="line">            mBottomTrans = UIRoot.Find(<span class="string">"Bottom"</span>);</span><br><span class="line">            mCommonTrans = UIRoot.Find(<span class="string">"Common"</span>);</span><br><span class="line">            mTopTrans = UIRoot.Find(<span class="string">"Top"</span>);</span><br><span class="line"></span><br><span class="line">            mCanvas = UIRoot.GetComponent&lt;Canvas&gt;();</span><br><span class="line">            mCanvasScaler = UIRoot.GetComponent&lt;CanvasScaler&gt;();</span><br><span class="line">            mGraphicRaycaster = UIRoot.GetComponent&lt;GraphicRaycaster&gt;();</span><br><span class="line">            mRectTransform = UIRoot.GetComponent&lt;RectTransform&gt;();</span><br><span class="line"></span><br><span class="line">            mEventSystem = UIRoot.Find(<span class="string">"EventSystem"</span>).GetComponent&lt;EventSystem&gt;();</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> RectTransform RectTransform</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">get</span> { <span class="keyword">return</span> mRectTransform; }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> GraphicRaycaster GraphicRaycaster</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">get</span> { <span class="keyword">return</span> mGraphicRaycaster; }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Canvas RootCanvas</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">get</span> { <span class="keyword">return</span> mCanvas; }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 设置分辨率</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="width"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="height"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetResolution</span>(<span class="params"><span class="keyword">int</span> width, <span class="keyword">int</span> height</span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            mCanvasScaler.referenceResolution = <span class="keyword">new</span> Vector2(width, height);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> T OpenUI&lt;T&gt;(<span class="keyword">string</span> PanelName, UILevel uiLevel) <span class="keyword">where</span> T:PanelView</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (!mAllPanel.ContainsKey(PanelName))</span><br><span class="line">            {</span><br><span class="line">                CreateUI(<span class="keyword">typeof</span>(T), PanelName, uiLevel);</span><br><span class="line">            }</span><br><span class="line">            mAllPanel[PanelName].SetActive(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span> mAllPanel[PanelName]<span class="keyword">as</span> T;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> OpenUIAsync&lt;T&gt;(<span class="keyword">string</span> PanelName, Action&lt;UnityEngine.Object&gt; onLoaded = <span class="literal">null</span>) <span class="keyword">where</span> T : PanelView, <span class="keyword">new</span>()</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (!mAllPanel.ContainsKey(PanelName))</span><br><span class="line">            {</span><br><span class="line">                CreateUIAsync&lt;T&gt;(PanelName,onLoaded);</span><br><span class="line">            }</span><br><span class="line">            onLoaded(<span class="literal">null</span>);</span><br><span class="line">           <span class="comment">// return mAllPanel[PanelName];</span></span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> CreateUIAsync&lt;T&gt;(<span class="keyword">string</span> panelName, Action&lt;UnityEngine.Object&gt; onLoaded) <span class="keyword">where</span> T : PanelView, <span class="keyword">new</span>()</span><br><span class="line">        {</span><br><span class="line">            ResMgr.Ins.LoadAsync(AssetBundleName.UI, panelName,onLoaded);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateUI</span>(<span class="params">Type type, <span class="keyword">string</span> panelName, UILevel uiLevel</span>) </span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            PanelView panelView = Activator.CreateInstance(type) <span class="keyword">as</span> PanelView;</span><br><span class="line"></span><br><span class="line">            Transform parent;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (uiLevel)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">case</span> UILevel.Bottom:</span><br><span class="line">                    parent = mBottomTrans;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> UILevel.Common:</span><br><span class="line">                    parent = mCommonTrans;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> UILevel.Top:</span><br><span class="line">                    parent = mTopTrans;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    parent = mCommonTrans;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            GameObject ui = GameObject.Instantiate(ResMgr.Ins.Load&lt;GameObject&gt;(AssetBundleName.UI, panelName), parent);</span><br><span class="line">            ui.name = panelName;</span><br><span class="line">            panelView.SetGameObject(ui);</span><br><span class="line">            panelView.Init();</span><br><span class="line">            mAllPanel.Add(panelName, panelView);</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ViewType Open&lt;ViewType&gt;(UILevel uiLevel = UILevel.Common) <span class="keyword">where</span> ViewType : PanelView</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> OpenUI&lt;ViewType&gt;( GetName&lt;ViewType&gt;(), uiLevel);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> OpenAsync&lt;T&gt;( Action&lt;UnityEngine.Object&gt; onLoaded = <span class="literal">null</span>) </span><br><span class="line">        {</span><br><span class="line">            OpenUIAsync&lt;PanelView&gt;(GetName&lt;T&gt;(), onLoaded);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">string</span> GetName&lt;T&gt;()</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (Runtime.Ins.IsHotResProject)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">string</span> name = <span class="keyword">typeof</span>(T).ToString();</span><br><span class="line">                <span class="keyword">return</span> name.Replace(<span class="string">"Type : "</span>, <span class="string">""</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">string</span> name = <span class="keyword">typeof</span>(T).ToString();</span><br><span class="line">                <span class="keyword">string</span>[] nameSplits = name.Split(<span class="string">'.'</span>);</span><br><span class="line">                <span class="keyword">return</span> nameSplits[nameSplits.Length - <span class="number">1</span>];</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//return name;</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LearnOpenGL(2)</title>
      <link href="/2019/06/17/LearnOpenGL-2/"/>
      <url>/2019/06/17/LearnOpenGL-2/</url>
      
        <content type="html"><![CDATA[<ul><li><strong>颜色向量(Color Vector)</strong>：一个通过红绿蓝(RGB)分量的组合描绘大部分真实颜色的向量。一个物体的颜色实际上是该物体所不能吸收的反射颜色分量。</li><li><strong>冯氏光照模型(Phong Lighting Model)</strong>：一个通过计算环境光，漫反射，和镜面光分量的值来估计真实光照的模型。</li><li><strong>环境光照(Ambient Lighting)</strong>：通过给每个没有被光照的物体很小的亮度，使其不是完全黑暗的，从而对全局光照进行估计。</li><li><strong>漫反射着色(Diffuse Shading)</strong>：一个顶点/片段与光线方向越接近，光照会越强。使用了法向量来计算角度。</li><li><strong>法向量(Normal Vector)</strong>：一个垂直于平面的单位向量。</li><li><strong>法线矩阵(Normal Matrix)</strong>：一个3x3矩阵，或者说是没有平移的模型（或者模型-观察）矩阵。它也被以某种方式修改（逆转置），从而在应用非统一缩放时，保持法向量朝向正确的方向。否则法向量会在使用非统一缩放时被扭曲。</li><li><strong>镜面光照(Specular Lighting)</strong>：当观察者视线靠近光源在表面的反射线时会显示的镜面高光。镜面光照是由观察者的方向，光源的方向和设定高光分散量的反光度值三个量共同决定的。</li><li><strong>冯氏着色(Phong Shading)</strong>：冯氏光照模型应用在片段着色器。</li><li><strong>Gouraud着色(Gouraud shading)</strong>：冯氏光照模型应用在顶点着色器上。在使用很少数量的顶点时会产生明显的瑕疵。会得到效率提升但是损失了视觉质量。</li><li><strong>GLSL结构体(GLSL struct)</strong>：一个类似于C的结构体，用作着色器变量的容器。大部分时间用来管理输入/输出/uniform。</li><li><strong>材质(Material)</strong>：一个物体反射的环境光，漫反射，镜面光颜色。这些东西设定了物体所拥有的颜色。</li><li><strong>光照属性(Light(properties))</strong>：一个光的环境光，漫反射，镜面光的强度。可以使用任何颜色值，对每一个冯氏分量(Phong Component)定义光源发出的颜色/强度。</li><li><strong>漫反射贴图(Diffuse Map)</strong>：一个设定了每个片段中漫反射颜色的纹理图片。</li><li><strong>镜面光贴图(Specular Map)</strong>：一个设定了每一个片段的镜面光强度/颜色的纹理贴图。仅在物体的特定区域显示镜面高光。</li><li><strong>定向光(Directional Light)</strong>：只有一个方向的光源。它被建模为不管距离有多长所有光束都是平行而且其方向向量在整个场景中保持不变。</li><li><strong>点光源(Point Light)</strong>：一个在场景中有位置的，光线逐渐衰减的光源。</li><li><strong>衰减(Attenuation)</strong>：光随着距离减少强度的过程，通常使用在点光源和聚光下。</li><li><strong>聚光(Spotlight)</strong>：一个被定义为在某一个方向上的锥形的光源。</li><li><strong>手电筒(Flashlight)</strong>：一个摆放在观察者视角的聚光。</li><li><strong>GLSL uniform数组(GLSL Uniform Array)</strong>：一个uniform值数组。它的工作原理和C语言数组大致一样，只是不能动态分配内存。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 图形学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenGL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LearnOpenGL-1</title>
      <link href="/2019/06/12/LearnOpenGL-1/"/>
      <url>/2019/06/12/LearnOpenGL-1/</url>
      
        <content type="html"><![CDATA[<ul><li><strong>OpenGL</strong>： 一个定义了函数布局和输出的图形API的正式规范。</li><li><strong>GLAD</strong>： 一个拓展加载库，用来为我们加载并设定所有OpenGL函数指针，从而让我们能够使用所有（现代）OpenGL函数。</li><li><strong>视口(Viewport)</strong>： 我们需要渲染的窗口。</li><li><strong>图形管线(Graphics Pipeline)</strong>： 一个顶点在呈现为像素之前经过的全部过程。</li><li><strong>着色器(Shader)</strong>： 一个运行在显卡上的小型程序。很多阶段的图形管道都可以使用自定义的着色器来代替原有的功能。</li><li><strong>标准化设备坐标(Normalized Device Coordinates, NDC)</strong>： 顶点在通过在剪裁坐标系中剪裁与透视除法后最终呈现在的坐标系。所有位置在NDC下-1.0到1.0的顶点将不会被丢弃并且可见。</li><li><strong>顶点缓冲对象(Vertex Buffer Object)</strong>： 一个调用显存并存储所有顶点数据供显卡使用的缓冲对象。</li><li><strong>顶点数组对象(Vertex Array Object)</strong>： 存储缓冲区和顶点属性状态。</li><li><strong>索引缓冲对象(Element Buffer Object)</strong>： 一个存储索引供索引化绘制使用的缓冲对象。</li><li><strong>Uniform</strong>： 一个特殊类型的GLSL变量。它是全局的（在一个着色器程序中每一个着色器都能够访问uniform变量），并且只需要被设定一次。</li><li><strong>纹理(Texture)</strong>： 一种包裹着物体的特殊类型图像，给物体精细的视觉效果。</li><li><strong>纹理缠绕(Texture Wrapping)</strong>： 定义了一种当纹理顶点超出范围(0, 1)时指定OpenGL如何采样纹理的模式。</li><li><strong>纹理过滤(Texture Filtering)</strong>： 定义了一种当有多种纹素选择时指定OpenGL如何采样纹理的模式。这通常在纹理被放大情况下发生。</li><li><strong>多级渐远纹理(Mipmaps)</strong>： 被存储的材质的一些缩小版本，根据距观察者的距离会使用材质的合适大小。</li><li><strong>stb_image.h</strong>： 图像加载库。</li><li><strong>纹理单元(Texture Units)</strong>： 通过绑定纹理到不同纹理单元从而允许多个纹理在同一对象上渲染。</li><li><strong>向量(Vector)</strong>： 一个定义了在空间中方向和/或位置的数学实体。</li><li><strong>矩阵(Matrix)</strong>： 一个矩形阵列的数学表达式。</li><li><strong>GLM</strong>： 一个为OpenGL打造的数学库。</li><li><strong>局部空间(Local Space)</strong>： 一个物体的初始空间。所有的坐标都是相对于物体的原点的。</li><li><strong>世界空间(World Space)</strong>： 所有的坐标都相对于全局原点。</li><li><strong>观察空间(View Space)</strong>： 所有的坐标都是从摄像机的视角观察的。</li><li><strong>裁剪空间(Clip Space)</strong>： 所有的坐标都是从摄像机视角观察的，但是该空间应用了投影。这个空间应该是一个顶点坐标最终的空间，作为顶点着色器的输出。OpenGL负责处理剩下的事情（裁剪/透视除法）。</li><li><strong>屏幕空间(Screen Space)</strong>： 所有的坐标都由屏幕视角来观察。坐标的范围是从0到屏幕的宽/高。</li><li><strong>LookAt矩阵</strong>： 一种特殊类型的观察矩阵，它创建了一个坐标系，其中所有坐标都根据从一个位置正在观察目标的用户旋转或者平移。</li><li><strong>欧拉角(Euler Angles)</strong>： 被定义为偏航角(Yaw)，俯仰角(Pitch)，和滚转角(Roll)从而允许我们通过这三个值构造任何3D方向。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 图形学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenGL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>虚拟遥感</title>
      <link href="/2019/06/06/%E8%99%9A%E6%8B%9F%E9%81%A5%E6%84%9F/"/>
      <url>/2019/06/06/%E8%99%9A%E6%8B%9F%E9%81%A5%E6%84%9F/</url>
      
        <content type="html"><![CDATA[<figure class="highlight c#"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.EventSystems;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GameKit</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Joystick</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    {</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"摇杆最大半径(UGUI)"</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">float</span> maxRadius = <span class="number">0</span>;</span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"摇杆最小半径(UGUI)"</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">float</span> minRadius = <span class="number">0</span>;</span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"摇杆框"</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> Transform stickBorder;</span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"摇杆"</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> Transform stick;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 绑定的相机</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        [<span class="meta">HideInInspector</span>]</span><br><span class="line">        <span class="keyword">public</span> Camera camera;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 触摸的起始位置</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        Vector2 _touchStartPos;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 摇杆起始位置</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        Vector3 _stickBorderInitPos;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 当Stick的值改变时触发</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">event</span> Action&lt;Vector2&gt; onValueChange;</span><br><span class="line"></span><br><span class="line">        List&lt;KeyCode&gt; _pressedKeyCode = <span class="keyword">new</span> List&lt;KeyCode&gt;();</span><br><span class="line"></span><br><span class="line">        Vector2 _lastValue;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">bool</span> _isStickMode = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        CanvasGroup stickBorderGroup;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            _stickBorderInitPos = stickBorder.position;</span><br><span class="line">            stickBorderGroup = stickBorder.gameObject.GetComponent&lt;CanvasGroup&gt;();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FixedUpdate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            <span class="keyword">if</span> (_isStickMode == <span class="literal">false</span>)</span><br><span class="line">            {</span><br><span class="line">                CheckKeyPress(KeyCode.UpArrow);</span><br><span class="line">                CheckKeyPress(KeyCode.DownArrow);</span><br><span class="line">                CheckKeyPress(KeyCode.LeftArrow);</span><br><span class="line">                CheckKeyPress(KeyCode.RightArrow);</span><br><span class="line"></span><br><span class="line">                CheckKeyRelease(KeyCode.UpArrow);</span><br><span class="line">                CheckKeyRelease(KeyCode.DownArrow);</span><br><span class="line">                CheckKeyRelease(KeyCode.LeftArrow);</span><br><span class="line">                CheckKeyRelease(KeyCode.RightArrow);</span><br><span class="line"></span><br><span class="line">                Vector2 tempValue = Vector2.zero;</span><br><span class="line">                <span class="keyword">if</span> (_pressedKeyCode.Count &gt; <span class="number">0</span>)</span><br><span class="line">                {</span><br><span class="line">                    <span class="keyword">switch</span> (_pressedKeyCode[<span class="number">0</span>])</span><br><span class="line">                    {</span><br><span class="line">                        <span class="keyword">case</span> KeyCode.UpArrow:</span><br><span class="line">                            tempValue = Vector2.up;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> KeyCode.DownArrow:</span><br><span class="line">                            tempValue = Vector2.down;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> KeyCode.LeftArrow:</span><br><span class="line">                            tempValue = Vector2.left;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> KeyCode.RightArrow:</span><br><span class="line">                            tempValue = Vector2.right;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                SetValue(tempValue);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">SetValue</span>(<span class="params">Vector2 <span class="keyword">value</span></span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            <span class="keyword">if</span> (_lastValue != <span class="keyword">value</span>)</span><br><span class="line">            {</span><br><span class="line">                _lastValue = <span class="keyword">value</span>;</span><br><span class="line">                onValueChange?.Invoke(_lastValue);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">CheckKeyPress</span>(<span class="params">KeyCode keyCode</span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            <span class="keyword">if</span> (Input.GetKeyDown(keyCode))</span><br><span class="line">            {</span><br><span class="line">                _pressedKeyCode.Remove(keyCode);</span><br><span class="line">                _pressedKeyCode.Insert(<span class="number">0</span>, keyCode);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">CheckKeyRelease</span>(<span class="params">KeyCode keyCode</span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            <span class="keyword">if</span> (!Input.GetKey(keyCode))</span><br><span class="line">            {</span><br><span class="line">                _pressedKeyCode.Remove(keyCode);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 得到指定GameObject下，鼠标相对的localposition坐标</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="go"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function">Vector2 <span class="title">GetLocalMousePosition</span>(<span class="params">GameObject go</span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> == camera)</span><br><span class="line">            {</span><br><span class="line">               Debug.LogError(<span class="string">"Joystick need binding a camera"</span>);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            Vector2 screenMouse = <span class="keyword">new</span> Vector2(Input.mousePosition.x, Input.mousePosition.y);</span><br><span class="line">            Vector2 localPoint;</span><br><span class="line">            RectTransformUtility.ScreenPointToLocalPointInRectangle(go.GetComponent&lt;RectTransform&gt;(), screenMouse, camera, <span class="keyword">out</span> localPoint);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Debug.LogFormat("Mouse:{0}  Screen:{1}  LocalPoint:{2}", Input.mousePosition, screenMouse, localPoint);</span></span><br><span class="line">            <span class="keyword">return</span> localPoint;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 触摸开始的时候</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="e"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPointerDown</span>(<span class="params">BaseEventData e</span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            stickBorder.localPosition = GetLocalMousePosition(gameObject);</span><br><span class="line"></span><br><span class="line">            stickBorderGroup.alpha = <span class="number">0.4f</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 滑动开始的时候</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="e"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnBeginDrag</span>(<span class="params">BaseEventData e</span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            _isStickMode = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            _touchStartPos = GetLocalMousePosition(stickBorder.gameObject);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 滑动中</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="e"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnDrag</span>(<span class="params">BaseEventData e</span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            Vector2 touchNowPos = GetLocalMousePosition(stickBorder.gameObject);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> moveVector = (touchNowPos - _touchStartPos);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (moveVector.magnitude &lt;= minRadius)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            moveVector = Vector3.ClampMagnitude(moveVector, maxRadius);</span><br><span class="line">           </span><br><span class="line">            stick.localPosition = moveVector;</span><br><span class="line"></span><br><span class="line">            Vector2 <span class="keyword">value</span> = <span class="keyword">new</span> Vector2(moveVector.x, moveVector.y);</span><br><span class="line"></span><br><span class="line">            SetValue(<span class="keyword">value</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 滑动结束的时候</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="e"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnEndDrag</span>(<span class="params">BaseEventData e</span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            stick.localPosition = Vector3.zero;</span><br><span class="line">            onValueChange?.Invoke(Vector2.zero);</span><br><span class="line">            _isStickMode = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            ResetStickBorder();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">ResetStickBorder</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        {</span><br><span class="line">            stickBorderGroup.alpha = <span class="number">0.0f</span>;</span><br><span class="line">            stickBorder.position = _stickBorderInitPos;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TODO</title>
      <link href="/2019/06/05/TODO/"/>
      <url>/2019/06/05/TODO/</url>
      
        <content type="html"><![CDATA[<ol><li>《C++必知必会》</li></ol>]]></content>
      
      
      <categories>
          
          <category> 日常 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日常 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1.入门</title>
      <link href="/2019/06/04/1-%E5%85%A5%E9%97%A8/"/>
      <url>/2019/06/04/1-%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="渲染流水线"><a href="#渲染流水线" class="headerlink" title="渲染流水线"></a>渲染流水线</h3><h4 id="坐标转换依次顺序"><a href="#坐标转换依次顺序" class="headerlink" title="坐标转换依次顺序"></a>坐标转换依次顺序</h4><p>Object space 模型空间 </p><p>World space 世界坐标系空间</p><p>Eye space 观察坐标系空间</p><p>Clip and Project space 屏幕坐标空间</p><p>注意： </p><ol><li>光照计算通常在World coordinate space（世界坐标空间）里计算，也可以在Eye space 里计算。</li><li>顶点法向量属于Object space ，转化为World space时，要通过（world matrix）转置矩阵的逆矩阵来转换 （复习线性代数去了）</li></ol><h4 id="Eye-Space"><a href="#Eye-Space" class="headerlink" title="Eye Space"></a>Eye Space</h4><p>以Camera为原点 ，由视线方向、视角和远近平面共同组成一个梯形三维空间，称之为viewing frustum（视锥），超出部分会被裁剪 frustum culling（视锥裁剪）</p><p><img src="https://i.loli.net/2019/06/04/5cf686f0789c270813.png" alt=""></p><h3 id="Project-and-clip-space"><a href="#Project-and-clip-space" class="headerlink" title="Project and clip space"></a>Project and clip space</h3><p>因为在不规则的体（viewing frustum）中进行裁剪并非易事，所以应该是先投影再裁剪具体分为三个步骤：</p><ol><li>用透视变换矩阵把顶点从视锥体中变换到裁剪空间的CVV中；</li><li>在CVV进行图元裁剪；</li><li>屏幕映射：将进过前述过程得到的坐标映射到屏幕坐标系上。</li></ol><ul><li>在第一个步骤里的过程为“投影”，主要投影方法有两种：正交投影和透视投影。</li><li>只有图元完全或部分存在于视锥内部时才需要光栅化。超出部分进行裁剪。</li><li>视点去除可以不用在GPU中进行，可以使用高级语言在CPU上实现，提前可减去GPU负担。</li></ul><h4 id="Primitive-Assemble-amp-amp-Triangle-setup"><a href="#Primitive-Assemble-amp-amp-Triangle-setup" class="headerlink" title="Primitive Assemble&amp;&amp;Triangle setup"></a>Primitive Assemble&amp;&amp;Triangle setup</h4><ul><li>Primitive Assembly，图元装配，即将顶点根据Primitive（原始的连接关系），还原出网格结构。</li><li>涉及到三角形的顶点顺序（三角形的法向量朝向）根据右手来决定三角面片的法向量（逆时针排列），法向量朝向视点为正，如果为反面进行背面去除操作（Back-face-Culling）。</li><li>所有的裁剪剔除都是为了减少需要绘制的顶点个数。</li><li>裁剪算法主要包括：视域剔除（View Frustum Culing）、背面剔除（Back-Face Culling）、遮挡剔除（Occlusing Culling）和视口裁剪等。</li></ul><h4 id="光栅化"><a href="#光栅化" class="headerlink" title="光栅化"></a>光栅化</h4><p>目前我们拿到了每个点的屏幕坐标值（Screen coordinate），也知道我们需要绘制的图元（点、线、面）但是有两个问题：</p><ol><li>点的屏幕坐标都是浮点数，像素都是由整数表示。（绘制的位置为接近两指定端点的实际线段位置如（10.48，20.51）转化为（10，21）四舍五入 或 加0.5取整）。</li><li>在屏幕上需要绘制的有点、线、面，如何根据两个已经确定位置的2个像素点绘制一条线段，如何根据已经确定了位置的3个像素点绘制一个三角形面片。（区域填充推荐慕课课程<a href="https://www.icourse163.org/course/HUST-1003636001" target="_blank" rel="noopener">大力点击进入</a>）</li></ol><h4 id="Pixel-Operation"><a href="#Pixel-Operation" class="headerlink" title="Pixel Operation"></a>Pixel Operation</h4><p>片元操作：计算出每个像素的颜色值，包括</p><ol><li><p>被遮挡面通过一个被称为深度测试的过程而消除。</p></li><li><p>Texture operatioin，纹理操作，根据像素的纹理坐标，查询对应的纹理值。</p></li><li><p>Blending，混合，根据目前已经画好的颜色，与正在计算的颜色的透明度混合为两种颜色，作为新的颜色输出，通常称之为alpha混合技术。屏幕上的每个像素都关联一个RGB颜色值和一个Z缓冲器深度值，alpha值（可以根据需要生成并存储）。</p><p>从渲染管线得到的RGBA，使用over操作符进行混合：</p><p>，<img src="https://i.loli.net/2019/06/05/5cf698001d1b841551.png" alt=""></p><p>a是透明度值（alpha）Ca表示透明物体的颜色，Cs表示混合前像素的颜色，Cd为最终计算得到的颜色。</p><p>为了绘制透明物体，需要对物体进行排序，用z buffer 首先绘制不透明物体，然后从后往前混合透明物体。</p></li><li><p>Filtering，将正在算的颜色经过某种Filtering（滤波）后输出，可以理解为：经过一种数学运算变成新的颜色值。（如最近邻滤波和线性滤波)</p></li></ol><h4 id="最终像素的颜色写入帧缓存，过程如下图"><a href="#最终像素的颜色写入帧缓存，过程如下图" class="headerlink" title="最终像素的颜色写入帧缓存，过程如下图"></a>最终像素的颜色写入帧缓存，过程如下图</h4><p><img src="https://i.loli.net/2019/06/05/5cf69aa2962f261841.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 图形学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图形学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图形学学习计划</title>
      <link href="/2019/06/04/%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/"/>
      <url>/2019/06/04/%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/</url>
      
        <content type="html"><![CDATA[<ul><li>入门 CG语言与GPU的概念 书籍《GPU编程与CG语言之阳春白雪下里巴人》<a href="https://github.com/ZhaoriGame/LearnBook/tree/master/GPU编程与CG语言之阳春白雪下里巴人" target="_blank" rel="noopener">PDF</a></li><li><a href="https://learnopengl-cn.github.io/" target="_blank" rel="noopener">学习OpenGL</a></li><li><a href="https://c.open.163.com/search/search.htm?query=%E5%8F%AF%E6%B1%97%E5%AD%A6%E9%99%A2%E5%85%AC%E5%BC%80%E8%AF%BE&amp;enc=%E2%84%A2#/search/course" target="_blank" rel="noopener">微积分线性代数</a></li><li><a href="https://space.bilibili.com/88461692?from=search&amp;seid=15188007523892428832" target="_blank" rel="noopener">B站</a></li><li><a href="https://www.khronos.org/registry/OpenGL/specs/gl/glspec33.core.pdf" target="_blank" rel="noopener">OpenGLPDF</a></li><li>学习OpenGL的子集OpenGL ES 的子集WebGL 《WebGL编程指南》</li><li>OpenGL红宝书 <a href="http://www.glprogramming.com/red/" target="_blank" rel="noopener">OpenGL Programming Guide</a></li><li><a href="http://open.163.com/special/opencourse/fouriertransforms.html" target="_blank" rel="noopener">斯坦福大学公开课：傅里叶变换及其应用</a> <a href="https://github.com/ZhaoriGame/LearnBook/blob/master/图形学/傅里叶变换及其应用斯坦福大学讲义自制目录版.pdf" target="_blank" rel="noopener">讲义</a></li><li><a href="https://krasjet.github.io/quaternion/quaternion.pdf" target="_blank" rel="noopener">四元数</a></li><li><a href="https://space.bilibili.com/88461692" target="_blank" rel="noopener">线性代数和微分…</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 图形学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图形学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac终端命令</title>
      <link href="/2019/06/03/Mac%E7%BB%88%E7%AB%AF%E5%91%BD%E4%BB%A4/"/>
      <url>/2019/06/03/Mac%E7%BB%88%E7%AB%AF%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h3 id="出现’permission-denied-的解决办法"><a href="#出现’permission-denied-的解决办法" class="headerlink" title="出现’permission denied: 的解决办法"></a>出现’permission denied: 的解决办法</h3> <figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libs chmod 777 path</span><br></pre></td></tr></tbody></table></figure><h3 id="查看端口占用情况命令"><a href="#查看端口占用情况命令" class="headerlink" title="查看端口占用情况命令"></a>查看端口占用情况命令</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -i tcp:port</span><br><span class="line">//如： sudo lsof -i tcp:8082</span><br></pre></td></tr></tbody></table></figure><h3 id="看到进程的PID，可以将进程杀死。"><a href="#看到进程的PID，可以将进程杀死。" class="headerlink" title="看到进程的PID，可以将进程杀死。"></a>看到进程的PID，可以将进程杀死。</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo kill -9 PID</span><br><span class="line">//如：sudo kill -9 3210</span><br></pre></td></tr></tbody></table></figure><h3 id="苹果打包隐藏Home键"><a href="#苹果打包隐藏Home键" class="headerlink" title="苹果打包隐藏Home键"></a>苹果打包隐藏Home键</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(UIRectEdge)preferredScreenEdgesDeferringSystemGestures</span><br><span class="line">{</span><br><span class="line">  return UIRectEdgeAll;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>提问的智慧</title>
      <link href="/2019/05/31/%E6%8F%90%E9%97%AE%E7%9A%84%E6%99%BA%E6%85%A7/"/>
      <url>/2019/05/31/%E6%8F%90%E9%97%AE%E7%9A%84%E6%99%BA%E6%85%A7/</url>
      
        <content type="html"><![CDATA[<p>提问的智慧，值得珍藏</p><p><a href="https://lug.ustc.edu.cn/wiki/doc/smart-questions" target="_blank" rel="noopener">提问的智慧</a></p>]]></content>
      
      
      <categories>
          
          <category> 通用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 提问 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Scrollview优化列表组件</title>
      <link href="/2019/05/31/Scrollview%E4%BC%98%E5%8C%96%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6/"/>
      <url>/2019/05/31/Scrollview%E4%BC%98%E5%8C%96%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h4 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h4><ul><li>基于队列实现</li><li>根据当前Content视口的大小计算出视口里最多存在的Item</li><li>根据位置不断更新当前显示的数据</li></ul><figure class="highlight c#"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 基于UGUI ScrollView组件的高性能列表组件。对性能有高要求的列表组件可以考虑使用该组件</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">[<span class="meta">RequireComponent(typeof(ScrollRect))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ScrollViewList</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> ELayoutType</span><br><span class="line">    {</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 垂直列表</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        VERTICAL,</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 横向列表</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        HORIZONTAL,        </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 布局方式</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> ELayoutType layoutType = ELayoutType.VERTICAL;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 列表项的间隔</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> itemGap = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 滚动组件</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    ScrollRect _scrollRect;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 存储位置</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    RectTransform _content;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 列表项的Prefab，默认Content第一个物体</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    GameObject _itemPrefab;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 列表项的大小</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    Vector2 _itemSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 生成的列表项示例列表</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    List&lt;GameObject&gt; _items = <span class="keyword">new</span> List&lt;GameObject&gt;();    </span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 列表视口</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    Rect _viewport;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 视口可见的最大列表项数量</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">int</span> _itemMaxCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 列表的数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">object</span>[] _datas;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 列表项更新的回调</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    Action&lt;<span class="keyword">int</span>, <span class="keyword">object</span>, GameObject&gt; _onItemUpdate;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 列表项占用的空间</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">float</span> _itemSpace = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Item 的缓存池 </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    Queue&lt;GameObject&gt; _itemPool = <span class="keyword">new</span> Queue&lt;GameObject&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 正在显示的列表项</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    Dictionary&lt;<span class="keyword">int</span>, GameObject&gt; _showedDic = <span class="keyword">new</span> Dictionary&lt;<span class="keyword">int</span>, GameObject&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        _scrollRect = GetComponent&lt;ScrollRect&gt;();</span><br><span class="line">        _viewport = _scrollRect.GetComponent&lt;RectTransform&gt;().rect;</span><br><span class="line">        _content = transform.Find(<span class="string">"Viewport/Content"</span>).GetComponent&lt;RectTransform&gt;();</span><br><span class="line">        _itemPrefab = _content.GetChild(<span class="number">0</span>).gameObject;</span><br><span class="line">        <span class="keyword">var</span> rt = _itemPrefab.GetComponent&lt;RectTransform&gt;();</span><br><span class="line">        _itemSize = rt.sizeDelta;</span><br><span class="line">        <span class="keyword">var</span> topLeft = <span class="keyword">new</span> Vector2(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        rt.pivot = topLeft;</span><br><span class="line">        rt.anchorMin = topLeft;</span><br><span class="line">        rt.anchorMax = topLeft;</span><br><span class="line">        _itemPrefab.SetActive(<span class="literal">false</span>);</span><br><span class="line">        SetItemGap(itemGap);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">region</span> 测试</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//public void Update()</span></span><br><span class="line">    <span class="comment">//{</span></span><br><span class="line">    <span class="comment">//    if (Input.GetKeyDown(KeyCode.A))</span></span><br><span class="line">    <span class="comment">//    {</span></span><br><span class="line">    <span class="comment">//        SetItemUpdata(OnItemUpDate);</span></span><br><span class="line">    <span class="comment">//        SetItemGap(10);</span></span><br><span class="line">    <span class="comment">//        List&lt;string&gt; ls = new List&lt;string&gt;();</span></span><br><span class="line">    <span class="comment">//        for (int i = 0; i &lt; 1000000; i++)</span></span><br><span class="line">    <span class="comment">//        {</span></span><br><span class="line">    <span class="comment">//            ls.Add("current"+i);</span></span><br><span class="line">    <span class="comment">//        }</span></span><br><span class="line">    <span class="comment">//        SetData(ls.ToArray());</span></span><br><span class="line">    <span class="comment">//    }</span></span><br><span class="line">    <span class="comment">//}</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 设置列表项间隙</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="gap"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetItemGap</span>(<span class="params"><span class="keyword">float</span> gap</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        itemGap = gap;</span><br><span class="line">        SetData(_datas);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        _scrollRect.onValueChanged.AddListener(OnScroll);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetData</span>(<span class="params"><span class="keyword">object</span>[] data</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        Clear();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (layoutType)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">case</span> ELayoutType.VERTICAL:</span><br><span class="line">                _itemSpace = _itemSize.y + itemGap;</span><br><span class="line">                _itemMaxCount = Mathf.CeilToInt(_viewport.height / _itemSpace) + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ELayoutType.HORIZONTAL:</span><br><span class="line">                _itemSpace = _itemSize.x + itemGap;</span><br><span class="line">                _itemMaxCount = Mathf.CeilToInt(_viewport.width / _itemSpace) + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }      </span><br><span class="line"></span><br><span class="line">        _datas = data;</span><br><span class="line">        <span class="keyword">if</span> (data != <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            _refreRate = <span class="number">0.1f</span> / data.Length;</span><br><span class="line">        }</span><br><span class="line">        Debug.LogError(_refreRate);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == _datas || _datas.Length == <span class="number">0</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> count = _datas.Length;</span><br><span class="line">        SetContentSize((_itemSpace * count) - itemGap);</span><br><span class="line">        RefreshUI();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 显示指定索引位置的列表项</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="idx"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowItem</span>(<span class="params"><span class="keyword">int</span> idx</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> == _datas)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">var</span> pos = _itemSpace * idx;</span><br><span class="line">        SetContentPos(pos);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetContentSize</span>(<span class="params"><span class="keyword">float</span> size</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">var</span> contentSize = _content.sizeDelta;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (layoutType)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">case</span> ELayoutType.VERTICAL:</span><br><span class="line">                contentSize.y = size;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ELayoutType.HORIZONTAL:</span><br><span class="line">                contentSize.x = size;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        _content.sizeDelta = contentSize;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetContentPos</span>(<span class="params"><span class="keyword">float</span> pos</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">var</span> contentPos = _content.localPosition;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (layoutType)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">case</span> ELayoutType.VERTICAL:</span><br><span class="line">                contentPos.y = pos;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ELayoutType.HORIZONTAL:</span><br><span class="line">                contentPos.x = <span class="number">-1</span> * pos;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        _content.localPosition = contentPos;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Clear</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; _items.Count; i++)</span><br><span class="line">        {</span><br><span class="line">            GameObject.Destroy(_items[i]);</span><br><span class="line">        }</span><br><span class="line">        _showedDic.Clear();</span><br><span class="line">        _items.Clear();</span><br><span class="line">        _itemPool.Clear();</span><br><span class="line">        _datas = <span class="literal">null</span>;</span><br><span class="line">        _scrollRect.velocity = Vector2.one;</span><br><span class="line"></span><br><span class="line">        SetContentPos(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (layoutType)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">case</span> ELayoutType.VERTICAL:</span><br><span class="line">                SetContentSize(_viewport.height);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ELayoutType.HORIZONTAL:</span><br><span class="line">                SetContentSize(_viewport.width);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        _scrollRect.onValueChanged.RemoveListener(OnScroll);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 当前位置</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> Vector2 _currentPos;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> _refreRate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnScroll</span>(<span class="params">Vector2 v</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">if</span> (CompareVector2(v, _currentPos ,_refreRate))</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        } </span><br><span class="line"></span><br><span class="line">        _currentPos = v;</span><br><span class="line">        RefreshUI();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">bool</span> <span class="title">CompareVector2</span>(<span class="params">Vector2 v1,Vector2 v2,<span class="keyword">float</span> dis</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">return</span> Mathf.Abs(v1.x - v2.x) &lt; dis &amp;&amp; Mathf.Abs(v1.y - v2.y) &lt; dis;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    HashSet&lt;<span class="keyword">int</span>&gt; updateNeedlessSet = <span class="keyword">new</span> HashSet&lt;<span class="keyword">int</span>&gt;();</span><br><span class="line">    Dictionary&lt;<span class="keyword">int</span>, GameObject&gt; showedDic = <span class="keyword">new</span> Dictionary&lt;<span class="keyword">int</span>, GameObject&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 刷新界面</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">RefreshUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    {       </span><br><span class="line">        <span class="keyword">if</span>( _datas == <span class="literal">null</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> localPos;</span><br><span class="line">        <span class="keyword">if</span>(layoutType == ELayoutType.VERTICAL)</span><br><span class="line">        {</span><br><span class="line">            localPos = _content.localPosition.y;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            localPos = <span class="number">-1</span> * _content.localPosition.x ;</span><br><span class="line">        }        </span><br><span class="line"></span><br><span class="line">        <span class="comment">//显示开始的索引</span></span><br><span class="line">        <span class="keyword">int</span> startIdx = Mathf.FloorToInt(localPos / _itemSpace);</span><br><span class="line">        <span class="keyword">if</span>(startIdx &lt; <span class="number">0</span>)</span><br><span class="line">        {</span><br><span class="line">            startIdx = <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Item 显示开始的位置      </span></span><br><span class="line">        Vector2 pos = <span class="keyword">new</span> Vector2(<span class="number">0f</span>, startIdx * _itemSpace);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> endIdx = startIdx + _itemMaxCount;</span><br><span class="line">        <span class="keyword">if</span> (endIdx &gt; _datas.Length)</span><br><span class="line">        {</span><br><span class="line">            endIdx = _datas.Length;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        HashSet&lt;<span class="keyword">int</span>&gt; updateNeedlessSet = <span class="keyword">new</span> HashSet&lt;<span class="keyword">int</span>&gt;();</span><br><span class="line">        Dictionary&lt;<span class="keyword">int</span>, GameObject&gt; showedDic = <span class="keyword">new</span> Dictionary&lt;<span class="keyword">int</span>, GameObject&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//找出可以不用更新的Item</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> entry <span class="keyword">in</span> _showedDic)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(entry.Key &gt;= startIdx &amp;&amp; entry.Key &lt; endIdx)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">//不用更新的</span></span><br><span class="line">                updateNeedlessSet.Add(entry.Key);</span><br><span class="line">                showedDic.Add(entry.Key, entry.Value);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                <span class="comment">//加入缓存池</span></span><br><span class="line">                _itemPool.Enqueue(entry.Value);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        _showedDic = showedDic;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = startIdx; i &lt; endIdx; i++)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(updateNeedlessSet.Contains(i))</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">//已经显示的可以忽略不处理</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(layoutType == ELayoutType.VERTICAL)</span><br><span class="line">            {</span><br><span class="line">                pos.x = <span class="number">0f</span>;</span><br><span class="line">                pos.y = <span class="number">-1</span> * i * _itemSpace;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                pos.x = i * _itemSpace;</span><br><span class="line">                pos.y = <span class="number">0f</span>;                </span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            CreateItem(i, pos, _datas[i], _itemPool);  </span><br><span class="line">        }                    </span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnItemUpDate</span>(<span class="params"><span class="keyword">int</span> num, <span class="keyword">object</span> data, GameObject item</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        item.transform.Find(<span class="string">"Text"</span>).GetComponent&lt;Text&gt;().text = (<span class="keyword">string</span>)data;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetItemUpdata</span>(<span class="params">Action&lt;<span class="keyword">int</span> ,<span class="keyword">object</span>,GameObject&gt; ItemUpdata</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        _onItemUpdate = ItemUpdata;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> GameObject <span class="title">CreateItem</span>(<span class="params"><span class="keyword">int</span> idx, Vector2 pos, <span class="keyword">object</span> data, Queue&lt;GameObject&gt; itemPool</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        GameObject go = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(itemPool.Count &gt; <span class="number">0</span>)</span><br><span class="line">        {</span><br><span class="line">            go = itemPool.Dequeue();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            go = GameObject.Instantiate(_itemPrefab, _content);</span><br><span class="line">            go.name = <span class="string">"item"</span> + idx;</span><br><span class="line">            _items.Add(go);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        _showedDic.Add(idx, go);</span><br><span class="line">        go.transform.localPosition = pos;</span><br><span class="line">        go.SetActive(<span class="literal">true</span>);   </span><br><span class="line">        _onItemUpdate?.Invoke(idx, data, go);</span><br><span class="line">        <span class="keyword">return</span> go;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CG标准函数库</title>
      <link href="/2019/05/31/CG%E6%A0%87%E5%87%86%E5%87%BD%E6%95%B0%E5%BA%93/"/>
      <url>/2019/05/31/CG%E6%A0%87%E5%87%86%E5%87%BD%E6%95%B0%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h3 id="Cg-标准函数库"><a href="#Cg-标准函数库" class="headerlink" title="Cg 标准函数库"></a>Cg 标准函数库</h3><p>– 来自《 GPU编程与CG语言GPU-Programming-AndCgLanguage-Primer》</p><ol><li><p>数学函数（Mathematical Functions）;</p></li><li><p>几何函数(Geometric Functions)；</p></li><li><p>纹理映射函数(Texture Map Functions)；</p></li><li><p>偏导数函数(Derivative Functions)；</p></li><li><p>调试函数(Debugging Function)；</p></li></ol><h3 id="数学函数（Mathematical-Functions）"><a href="#数学函数（Mathematical-Functions）" class="headerlink" title="数学函数（Mathematical Functions）"></a>数学函数（Mathematical Functions）</h3><p>列举了 Cg 标准函数库中所有的数学函数，这些数学函数用于执行数学上常用计算，包括：三角函数、幂函数、园函数、向量和矩阵的操作函数。这些函数都被重载，以支持标量数据和不同长度的向量作为输入参数。</p><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>abs(x)</td><td>返回输入参数的绝对值</td></tr><tr><td>acos(x)</td><td>反余切函数，输入参数范围为[-1,1]， 返回[0,<em>p</em> ]区间的角度值</td></tr><tr><td>all(x)</td><td>如果输入参数均不为 0，则返回 ture；否则返回 flase。&amp;&amp;运算</td></tr><tr><td>any(x)</td><td>输入参数只要有其中一个不为 0，则返回true。\</td><td>\</td><td>运算</td></tr><tr><td>asin(x)</td><td>反正弦函数,输入参数取值区间为[-1,1] ，返回角度值范围为⎡⎢- <em>p</em> , <em>p</em> ⎤⎥⎣    2   2 ⎦</td></tr><tr><td>atan(x)</td><td>反正切函数，返回角度值范围为⎡- <em>p</em> , <em>p</em> ⎤⎢⎣    2  2 ⎥⎦</td></tr><tr><td>atan2(y,x)</td><td>计算 y/x 的反正切值。实际上和 atan(x)函数功能完全一样，至少输入参数不同。atan(x) =atan2(x, float(1))。</td></tr><tr><td>ceil(x)</td><td>对输入参数向上取整。例如：ceil(float(1.3)) ，其返回值为 2.0</td></tr><tr><td>clamp(x,a,b)</td><td>如果 x 值小于 a，则返回 a；如果 x 值大于 b，返回 b；否则，返回 x。</td></tr><tr><td>cos(x)</td><td>返回弧度 x 的余弦值。返回值范围为[-1,1]</td></tr><tr><td>cosh(x)</td><td>双曲余弦（hyperbolic cosine）函数，计算 x的双曲余弦值。</td></tr><tr><td>cross(A,B)</td><td>返回两个三元向量的叉积(cross product)。注意，输入参数必须是三元向量！</td></tr><tr><td>degrees(x)</td><td>输入参数为弧度值(radians)，函数将其转换为角度值(degrees)</td></tr></tbody></table><table><thead><tr><th style="text-align:left">determinant(m)</th><th style="text-align:left">计算矩阵的行列式因子。</th></tr></thead><tbody><tr><td style="text-align:left">dot(A,B)</td><td style="text-align:left">返回A 和 B 的点积(dot product)。参数 A 和 B可以是标量，也可以是向量（输入参数方面， 点积和叉积函数有很大不同）。</td></tr><tr><td style="text-align:left">exp(x)</td><td style="text-align:left">计算<em>e**x</em> 的值，e= 2.71828182845904523536</td></tr><tr><td style="text-align:left">exp2(x)</td><td style="text-align:left">计算2<em>x</em> 的值</td></tr><tr><td style="text-align:left">floor(x)</td><td style="text-align:left">对输入参数向下取整。例如 floor(float(1.3))返回的值为 1.0；但是 floor(float(-1.3))返回的值为-2.0。该函数与 ceil(x)函数相对应。</td></tr><tr><td style="text-align:left">fmod(x,y)</td><td style="text-align:left">返回 x/y 的余数。如果 y 为 0，结果不可预料。</td></tr><tr><td style="text-align:left">frac(x)</td><td style="text-align:left">Returns the fractional portion of a scalar oreach vector component</td></tr><tr><td style="text-align:left">frexp(x, out exp)</td><td style="text-align:left">将浮点数 x 分解为尾数和指数，即x = m* 2^exp，返回 m，并将指数存入 exp 中； 如果 x 为 0，则尾数和指数都返回 0</td></tr><tr><td style="text-align:left">isfinite(x)</td><td style="text-align:left">判断标量或者向量中的每个数据是否是有限数，如果是返回 true；否则返回 false;无限的或者非数据(not-a-number NaN)，</td></tr><tr><td style="text-align:left">isinf(x)</td><td style="text-align:left">判断标量或者向量中的每个数据是否是无限，如果是返回 true；否则返回 false;</td></tr><tr><td style="text-align:left">isnan(x)</td><td style="text-align:left">判断标量或者向量中的每个数据是否是非数据(not-a-number NaN)，如果是返回 true；否则返回 false;</td></tr><tr><td style="text-align:left">ldexp(x, n)</td><td style="text-align:left">计算 <em>x</em> <em> 2</em>n* 的值</td></tr><tr><td style="text-align:left">lerp(a, b, f)</td><td style="text-align:left">计算(1- <em>f</em> )<em> </em>a<em> + </em>b<em> </em> <em>f</em> 或者<em>a</em> + <em>f</em> <em>(</em>b<em> - </em>a*) 的值。即在下限 a 和上限 b 之间进行插值，f 表示权值。注意，如果 a 和 b 是向量，则权值 f 必须是标量或者等长的向量。</td></tr><tr><td style="text-align:left">lit(NdotL, NdotH, m)</td><td style="text-align:left">N 表示法向量；L 表示入射光向量；H 表示半角向量；m 表示高光系数。函数计算环境光、散射光、镜面光的贡献， 返回的 4 元向量：X 位表示环境光的贡献，总是 1.0；Y 位代表散射光的贡献，如果 <em>N</em> · <em>L</em> &lt; 0 ，则为 0；否则为 <em>N</em> · <em>L</em>Z 位代表镜面光的贡献，如果 <em>N</em> · <em>L</em> &lt; 0 或者<em>N</em> · <em>H</em> &lt; 0 ，则位 0；否则为(<em>N</em> · <em>H</em> )<em>m</em> ；W 位始终位 1.0</td></tr></tbody></table><table><thead><tr><th>log(x)</th><th>计算ln ( <em>x</em>) 的值，x 必须大于 0</th></tr></thead><tbody><tr><td>log2(x)</td><td>计算log(<em>x</em>) 的值，x 必须大于 02</td></tr><tr><td>log10(x)</td><td>计算log(<em>x</em>) 的值，x 必须大于 010</td></tr><tr><td>max(a, b)</td><td>比较两个标量或等长向量元素，返回最大值。</td></tr><tr><td>min(a,b)</td><td>比较两个标量或等长向量元素，返回最小值。</td></tr><tr><td>modf(x, out ip)</td><td>在 Cg Reference Manual 中没有查到</td></tr><tr><td>mul(M, N)</td><td>计算两个矩阵相乘，如果 M 为 AxB 阶矩阵，N 为 BxC 阶矩阵，则返回 AxC 阶矩阵。下面两个函数为其重载函数。</td></tr><tr><td>mul(M, v)</td><td>计算矩阵和向量相乘</td></tr><tr><td>mul(v, M)</td><td>计算向量和矩阵相乘</td></tr><tr><td>noise( x)</td><td>噪声函数，返回值始终在 0，1 之间；对于同样的输入，始终返回相同的值（也就是说， 并不是真正意义上的随机噪声）。</td></tr><tr><td>pow(x, y)</td><td><em>x</em> <em>y</em></td></tr><tr><td>radians(x)</td><td>函数将角度值转换为弧度值</td></tr><tr><td>round(x)</td><td>Round-to-nearest，或 closest integer to x 即四舍五入。</td></tr><tr><td>rsqrt(x)</td><td>X 的反平方根，x 必须大于 0</td></tr><tr><td>saturate(x)</td><td>如果 x 小于 0，返回 0；如果 x 大于 1，返回1；否则，返回 x</td></tr><tr><td>sign(x)</td><td>如果 x 大于 0，返回 1；如果 x 小于 0，返回01；否则返回 0。</td></tr><tr><td>sin(x)</td><td>输入参数为弧度，计算正弦值，返回值范围为[-1,1]</td></tr><tr><td>sincos(float x, out s, out c)</td><td>该函数是同时计算 x 的 sin 值和 cos 值，其中s=sin(x)，c=cos(x)。该函数用于“同时需要计算 sin 值和 cos 值的情况”，比分别运算要快很多!</td></tr><tr><td>sinh(x)</td><td>计算双曲正弦（hyperbolic sine）值。</td></tr><tr><td>smoothstep(min, max, x)</td><td>值 x 位于 min、max 区间中。如果 x=min，返回 0；如果 x=max，返回 1；如果 x 在两者之间，按照下列公式返回数据：-2<em>( </em>x<em> - min )3 + 3</em>( <em>x</em> - min )2max- min    max- min</td></tr><tr><td>step(a, x)</td><td>如果 x&lt;a，返回 0；否则，返回 1。</td></tr><tr><td>sqrt(x)</td><td>求 x 的平方根，    <em>x</em> ，x 必须大于 0。</td></tr></tbody></table><table><thead><tr><th>tan(x)</th><th>输入参数为弧度，计算正切值</th></tr></thead><tbody><tr><td>tanh(x)</td><td>计算双曲正切值</td></tr><tr><td>transpose(M)</td><td>M 为矩阵，计算其转置矩阵</td></tr></tbody></table><p>表 4 Cg 标准函数库中的数学函数</p><h3 id="几何函数（Geometric-Functions"><a href="#几何函数（Geometric-Functions" class="headerlink" title="几何函数（Geometric Functions)"></a>几何函数（Geometric Functions)</h3><p>几何函数，如表 5 所示，用于执行和解析几何相关的计算，例如根据入射光向量和顶点法向量，求取反射光和折射光方向向量。Cg 语言标准函数库中有3 个几何函数会经常被使用到，分别是：normalize 函数，对向量进行归一化；reflect函数，计算反射光方向向量；refract 函数，计算折射光方向向量。大声呐喊，并要求强烈注意：</p><ol><li><p>着色程序中的向量最好进行归一化之后再使用，否则会出现难以预料的错误；</p></li><li><p>reflect 函数和 refract 函数都存在以“入射光方向向量”作为输入参数， 注意这两个函数中使用的入射光方向向量，是从外指向几何顶点的；平时我们在着色程序中或者在课本上都是将入射光方向向量作为从顶点出发。</p></li></ol><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>distance( pt1, pt2)</td><td>两点之间的欧几里德距离（Euclideandistance）</td></tr><tr><td>faceforward(N,I,Ng)</td><td>如果 <em>Ng</em> · <em>I</em> &lt; 0 ，返回 N；否则返回-N。</td></tr><tr><td>length(v)</td><td>返回一个向量的模，即 sqrt(dot(v,v))</td></tr><tr><td>normalize( v)</td><td>归一化向量</td></tr><tr><td>reflect(I, N)</td><td>根据入射光方向向量 I，和顶点法向量N，计算反射光方向向量。其中 I 和 N 必须被归一化，需要非常注意的是，这个 I 是指向顶点的；函数只对三元向量有效。</td></tr><tr><td>refract(I,N,eta)</td><td>计算折射向量，I 为入射光线，N 为法向量，eta 为折射系数；其中 I 和 N 必须被归一化，如果 I 和 N 之间的夹角太大，则返回（0，0，0），也就是没有折射光线；I 是指向顶点的；函数只对三元向量有效。</td></tr></tbody></table><p>表 5 Cg 标准函数库几何函数</p><h3 id="纹理映射函数（Texture-Map-Functions）"><a href="#纹理映射函数（Texture-Map-Functions）" class="headerlink" title="纹理映射函数（Texture Map Functions）"></a>纹理映射函数（Texture <strong>Map</strong> Functions）</h3><p>下表提供 Cg 标准函数库中的纹理映射函数。这些函数被 ps_2_0、ps_2_x、arbfp1、fp30 和 fp40  等 profiles 完全支持（fully supported）。所有的这些函数返回四元向量值。</p><table><thead><tr><th>函数</th><th></th></tr></thead><tbody><tr><td>tex1D(sampler1D tex, float s)一维纹理查询</td><td></td></tr><tr><td>tex1D(sampler1D tex, float s, float dsdx, float dsdy)使用导数值（derivatives）查询一维纹理</td><td></td></tr><tr><td>Tex1D(sampler1D tex, float2 sz)一维纹理查询，并进行深度值比较</td><td></td></tr><tr><td>Tex1D(sampler1D tex, float2 sz, float dsdx,float dsdy)使用导数值（derivatives）查询一维纹理， 并进行深度值比较</td><td></td></tr><tr><td>Tex1Dproj(sampler1D tex, float2 sq)一维投影纹理查询</td><td></td></tr><tr><td>Tex1Dproj(sampler1D tex, float3 szq)一维投影纹理查询，并比较深度值</td><td></td></tr><tr><td>Tex2D(sampler2D tex, float2 s)二维纹理查询</td><td></td></tr><tr><td>Tex2D(sampler2D tex, float2 s, float2 dsdx, float2 dsdy)使用导数值（derivatives）查询二维纹理</td><td></td></tr><tr><td>Tex2D(sampler2D tex, float3 sz)二维纹理查询，并进行深度值比较</td><td></td></tr><tr><td>Tex2D(sampler2D tex, float3 sz, float2 dsdx,float2 dsdy)使用导数值（derivatives）查询二维纹理，并进行深度值比较</td><td></td></tr><tr><td>Tex2Dproj(sampler2D tex, float3 sq)二维投影纹理查询</td><td></td></tr><tr><td>Tex2Dproj(sampler2D tex, float4 szq)二维投影纹理查询，并进行深度值比较</td><td></td></tr><tr><td>texRECT(samplerRECT tex, float2 s)</td><td></td></tr><tr><td>texRECT (samplerRECT tex, float2 s, float2 dsdx, float2 dsdy)</td><td></td></tr><tr><td>texRECT (samplerRECT tex, float3 sz)</td><td></td></tr><tr><td>texRECT (samplerRECT tex, float3 sz, float2 dsdx,float2 dsdy)</td><td></td></tr><tr><td>texRECT proj(samplerRECT tex, float3 sq) texRECT proj(samplerRECT tex, float3 szq)</td><td></td></tr><tr><td>Tex3D(sampler3D tex, float s)  三维纹理查询</td><td></td></tr><tr><td>Tex3D(sampler3D tex, float3 s, float3 dsdx, float3 dsdy)  结合导数值（derivatives）查询三维纹理</td><td></td></tr><tr><td>Tex3Dproj(sampler3D tex, float4 szq) 查询三维投影纹理，并进行深度值比较</td><td></td></tr><tr><td>texCUBE(samplerCUBE tex, float3 s)  查询立方体纹理</td><td></td></tr><tr><td>texCUBE (samplerCUBE tex, float3 s, float3 dsdx, float3 dsdy)  结合导数值（derivatives）查询立方体纹理</td><td></td></tr><tr><td>texCUBEproj (samplerCUBE tex, float4 sq) 查询投影立方体纹理</td><td></td></tr><tr><td></td></tr></tbody></table><p>​                                             标准函数库纹理映射函数</p><h3 id="偏导函数（Derivative-Functions）"><a href="#偏导函数（Derivative-Functions）" class="headerlink" title="偏导函数（Derivative Functions）"></a>偏导函数（Derivative Functions）</h3><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>ddx(a)</td><td>参数 a 对应一个像素位置，返回该像素 值在 X 轴上的偏导数</td></tr><tr><td>ddy(a)</td><td>参数 a 对应一个像素位置，返回该像素 值在 X 轴上的偏导数 表 7 Cg 标准函数库偏导函数</td></tr></tbody></table><h3 id="调试函数（Debugging-Function）"><a href="#调试函数（Debugging-Function）" class="headerlink" title="调试函数（Debugging Function）"></a>调试函数（Debugging Function）</h3><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>void debug(float4 x)</td><td>如果在编译时设置了 DEBUG，片段着 色程序中调用该函数可以将值 x 作为 COLOR 语义的终输出；否则该函数 什么也不做。</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 图形学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图形学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity里的标签</title>
      <link href="/2019/05/30/Unity%E9%87%8C%E7%9A%84%E6%A0%87%E7%AD%BE/"/>
      <url>/2019/05/30/Unity%E9%87%8C%E7%9A%84%E6%A0%87%E7%AD%BE/</url>
      
        <content type="html"><![CDATA[<figure class="highlight c#"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只允许一个同样的Component</span></span><br><span class="line">[<span class="meta">DisallowMultipleComponent</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Sample</span>:<span class="title">MonoBehaviour</span>{}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight c#"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Header(<span class="meta-string">"头标题"</span>)</span>]</span><br><span class="line">[<span class="meta">RequireComponent(Type of(<span class="meta-string">"必须加上的组件"</span>))</span>]</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
